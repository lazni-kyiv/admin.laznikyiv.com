import{b as u,m as G,d as M,s as F,e as V,H,n as P,x as z,j,o as p,f as s,c as g,z as D,w as K,h as y,v as h,F as O,E as Q,G as Y,q,a as J,t as C}from"./index-Djdg4anx.js";import{A as R}from"./AdminView-zm1vYfoj.js";import{t as W}from"./toastr-CY63SwY8.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";const Z={id:"guest",class:"modal"},tt={class:"form-input"},et={class:"form-input"},st={class:"form-input"},nt={class:"form-input"},ot={class:"form-input"},at={class:"header"},lt={class:"header__search"},rt={class:"form-input"},it={key:0,class:"guests"},ut={key:0,class:"not-found"},dt={class:"guest__info"},ct={key:0,class:"guest__name placeholder"},pt={key:1,class:"guest__name"},mt={key:2,class:"guest__id placeholder"},vt={class:"guest__id"},ft={__name:"DogovirView",setup(gt){const S=u([]),b=u(Array.from({length:10},()=>({}))),w=u("");u(null);const I=u(!0);u(null);const k=G(()=>[...b.value].reverse()),i=u({alias:null,name:null,birthday:null,document:null,phone:null}),N=u([]);async function $(){V.guests.create(i.value).then(o=>{i.value={alias:null,name:null,birthday:null,document:null,phone:null}})}const L=u("l");M(()=>{F({title:"Договори"}),sessionStorage.getItem("guest-error")=="get-error"&&(W.error("Помилка завантаження гостя"),sessionStorage.removeItem("guest-error")),V.guests.list().then(t=>{S.value=t.guests,b.value=t.guests,I.value=!1}),V.bookings.list().then(t=>{const a=t.bookings;b.value.forEach(e=>{let r=0;a.forEach(d=>{d.guest==e.$id&&(r+=1)}),e.bookings=r})})});function U(){b.value=S.value.filter(o=>String(o.name).toLowerCase().includes(String(w.value.trim()).toLowerCase())||String(_[o.$id]).toLowerCase().includes(String(w.value.trim()).toLowerCase()))}function E(o){const[t,a]=o.split("-");function e(r){const[d,m]=r.split("T"),c=2e3+parseInt(d.slice(0,2),10),v=parseInt(d.slice(2,4),10)-1,n=parseInt(d.slice(4,6),10),[l,f]=m.split(":").map(Number),A=new Date(c,v,n,l,f);if(isNaN(A))throw new Error(`Invalid date parsed: ${r}`);return A}return{startDate:e(t),endDate:e(a)}}function x(o){return new Date(o.getFullYear(),o.getMonth(),o.getDate())}function T(o){var v;const a=x(new Date),e=(v=N.value)==null?void 0:v.filter(n=>n.g===o&&typeof n.d=="string").map(n=>{try{const{startDate:l,endDate:f}=E(n.d);return{...n,startDate:l,endDate:f}}catch{return console.warn(`Skipping invalid booking: ${n.d}`),null}}).filter(n=>n!==null),r=(e==null?void 0:e.filter(n=>x(n.startDate)<a))||[],d=r.length>0?r.reduce((n,l)=>l.startDate>n.startDate?l:n,r[0]):null,m=(e==null?void 0:e.filter(n=>x(n.startDate)>=a))||[],c=m.length>0?m.reduce((n,l)=>l.startDate<n.startDate?l:n,m[0]):null;return{lastVisit:d,nextVisit:c}}T("guest123");async function B(o,t=6){const e=new TextEncoder().encode(o),r=await crypto.subtle.digest("SHA-256",e),m=Array.from(new Uint8Array(r)).map(f=>f.toString(16).padStart(2,"0")).join("");let c=BigInt("0x"+m.slice(0,16));const v="01234567890123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",n=BigInt(v.length);let l="";for(;c>0n;){const f=c%n;l=v[Number(f)]+l,c=c/n}return`${l.slice(0,t)}`}const _=H({});return P(()=>k.value,async o=>{if(o!=null&&o.length)for(const t of o){const a=t==null?void 0:t.$id;!a||_[a]||(_[a]=await B(a))}},{immediate:!0,deep:!0}),(o,t)=>(p(),z(R,null,{default:j(()=>{var a;return[s("dialog",Z,[s("form",{class:"modal-box",onSubmit:K($,["prevent"])},[t[12]||(t[12]=s("h3",{class:"text-lg font-bold mb-4"},"Додати бронювання",-1)),s("div",tt,[t[7]||(t[7]=s("label",{for:""},"Ім'я",-1)),y(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.value.alias=e)},null,512),[[h,i.value.alias]])]),s("div",et,[t[8]||(t[8]=s("label",{for:""},"ПІБ",-1)),y(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.value.name=e)},null,512),[[h,i.value.name]])]),s("div",st,[t[9]||(t[9]=s("label",{for:""},"Номер телефону",-1)),y(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>i.value.phone=e)},null,512),[[h,i.value.phone]])]),s("div",nt,[t[10]||(t[10]=s("label",{for:""},"Дата народження",-1)),y(s("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>i.value.birthday=e)},null,512),[[h,i.value.birthday]])]),s("div",ot,[t[11]||(t[11]=s("label",{for:""},"Документ",-1)),y(s("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>i.value.document=e)},null,512),[[h,i.value.document]])]),t[13]||(t[13]=s("div",{class:"modal-action",style:{"margin-top":"0.5rem"}},[s("button",{class:"secondary",type:"button",onclick:"guest.close()"}," Скасувати "),s("button",{type:"submit"},"Додати")],-1))],32)]),s("div",at,[t[14]||(t[14]=s("p",{class:"comment"},"Договори",-1)),s("div",lt,[s("div",rt,[y(s("input",{type:"",placeholder:"Пошук","onUpdate:modelValue":t[5]||(t[5]=e=>w.value=e),onInput:t[6]||(t[6]=e=>U())},null,544),[[h,w.value]])])])]),L.value=="l"?(p(),g("div",it,[b.value.length==0?(p(),g("p",ut,"Немає результатів")):D("",!0),((a=k.value)==null?void 0:a.length)>0?(p(!0),g(O,{key:1},Q(k.value,(e,r)=>(p(),g("div",{class:q(["guest",{lorem:I.value}]),style:Y(`animation-delay: ${.02*r}s`)},[t[16]||(t[16]=s("div",{class:"guest-text"},[s("div",{class:"guest__avatar"},[s("i",{class:"hgi hgi-stroke hgi-signature"})])],-1)),s("div",dt,[e!=null&&e.alias?(p(),g("div",pt,[t[15]||(t[15]=J(" №LK-2025-")),s("b",null,C(_[e.$id]||"..."),1)])):(p(),g("div",ct," 123123123123123 ")),e!=null&&e.alias?D("",!0):(p(),g("div",mt," 123123123123 ")),s("div",vt,C(e==null?void 0:e.name),1)]),t[17]||(t[17]=s("div",{class:"guest__actions"},[s("button",null,[s("i",{class:"hgi hgi-stroke hgi-pdf-01"})]),s("button",null,[s("i",{class:"hgi hgi-stroke hgi-google-drive"})])],-1))],6))),256)):D("",!0)])):D("",!0)]}),_:1}))}},Dt=X(ft,[["__scopeId","data-v-48c1150e"]]);export{Dt as default};
