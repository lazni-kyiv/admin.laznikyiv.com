import{a as $,q as Z,f as tt,x as et,g as O,e as nt,j,y as st,o as q,b as s,c as ot,d as lt,i as F,u as it,w as at,t as D,l as rt,z as U}from"./index-DfC6sHtH.js";import{t as V}from"./toastr-CY63SwY8.js";/* empty css                   */import{A as ct}from"./AdminView-DgyvBQoU.js";/* empty css                  */import{c as dt,b as Y,d as ut,e as mt,T as ht,D as J,m as B,f as L,y as p,g as G,V as ft,h as gt,j as pt,k as bt,n as yt,o as vt,p as Mt,q as Rt,r as St,F as Dt,l as kt,i as Tt,a as wt}from"./uk-DVrgmjrh.js";import{D as xt}from"./DogovirActions-dr_83eGJ.js";import{_ as Ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";import"./Icon-CMnBudPe.js";class Et extends J{constructor(){super(...arguments),this.buildDayTableModel=B(yt),this.slicer=new vt,this.state={labelId:Mt()}}render(){const{props:n,state:i,context:o}=this,{dateProfile:d,forPrint:a}=n,{options:y}=o,u=this.buildDayTableModel(d,o.dateProfileGenerator),v=this.slicer.sliceProps(n,d,y.nextDayThreshold,o,u),M=n.tableWidth!=null?n.tableWidth/y.aspectRatio:null,b=u.cells.length,h=M!=null?M/b:null;return p("div",{ref:n.elRef,"data-date":n.isoDateStr,className:"fc-multimonth-month",style:{width:n.width},role:"grid","aria-labelledby":i.labelId},p("div",{className:"fc-multimonth-header",style:{marginBottom:h},role:"presentation"},p("div",{className:"fc-multimonth-title",id:i.labelId},o.dateEnv.format(n.dateProfile.currentRange.start,n.titleFormat)),p("table",{className:["fc-multimonth-header-table",o.theme.getClass("table")].join(" "),role:"presentation"},p("thead",{role:"rowgroup"},p(St,{dateProfile:n.dateProfile,dates:u.headerDates,datesRepDistinctDays:!1})))),p("div",{className:["fc-multimonth-daygrid","fc-daygrid","fc-daygrid-body",!a&&"fc-daygrid-body-balanced",a&&"fc-daygrid-body-unbalanced",a&&"fc-daygrid-body-natural"].join(" "),style:{marginTop:-h}},p("table",{className:["fc-multimonth-daygrid-table",o.theme.getClass("table")].join(" "),style:{height:a?"":M},role:"presentation"},p("tbody",{role:"rowgroup"},p(Rt,Object.assign({},v,{dateProfile:d,cells:u.cells,eventSelection:n.eventSelection,dayMaxEvents:!a,dayMaxEventRows:!a,showWeekNumbers:y.weekNumbers,clientWidth:n.clientWidth,clientHeight:n.clientHeight,forPrint:a}))))))}}class _t extends J{constructor(){super(...arguments),this.splitDateProfileByMonth=B(Ht),this.buildMonthFormat=B(Pt),this.scrollElRef=L(),this.firstMonthElRef=L(),this.needsScrollReset=!1,this.handleSizing=n=>{n&&this.updateSize()}}render(){const{context:n,props:i,state:o}=this,{options:d}=n,{clientWidth:a,clientHeight:y}=o,u=o.monthHPadding||0,v=Math.min(a!=null?Math.floor(a/(d.multiMonthMinWidth+u)):1,d.multiMonthMaxColumns)||1,M=100/v+"%",b=a==null?null:a/v-u,h=a!=null&&v===1,k=this.splitDateProfileByMonth(n.dateProfileGenerator,i.dateProfile,n.dateEnv,h?!1:d.fixedWeekCount,d.showNonCurrentDates),H=this.buildMonthFormat(d.multiMonthTitleFormat,k),N=["fc-multimonth",h?"fc-multimonth-singlecol":"fc-multimonth-multicol",b!=null&&b<400?"fc-multimonth-compact":"",i.isHeightAuto?"":"fc-scroller"];return p(ft,{elRef:this.scrollElRef,elClasses:N,viewSpec:n.viewSpec},k.map((E,W)=>{const w=G(E.currentRange.start);return p(Et,Object.assign({},i,{key:w,isoDateStr:w,elRef:W===0?this.firstMonthElRef:void 0,titleFormat:H,dateProfile:E,width:M,tableWidth:b,clientWidth:a,clientHeight:y}))}))}componentDidMount(){this.updateSize(),this.context.addResizeHandler(this.handleSizing),this.requestScrollReset()}componentDidUpdate(n){gt(n,this.props)||this.handleSizing(!1),n.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}updateSize(){const n=this.scrollElRef.current,i=this.firstMonthElRef.current;n&&this.setState({clientWidth:n.clientWidth,clientHeight:n.clientHeight}),i&&n&&this.state.monthHPadding==null&&this.setState({monthHPadding:n.clientWidth-i.firstChild.offsetWidth})}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.state.monthHPadding!=null){const{currentDate:n}=this.props.dateProfile,i=this.scrollElRef.current,o=i.querySelector(`[data-date="${G(n)}"]`);i.scrollTop=o.getBoundingClientRect().top-this.firstMonthElRef.current.getBoundingClientRect().top,this.needsScrollReset=!1}}shouldComponentUpdate(){return!0}}const $t=dt(1,"month");function Ht(R,n,i,o,d){const{start:a,end:y}=n.currentRange;let u=a;const v=[];for(;u.valueOf()<y.valueOf();){const M=i.add(u,$t),b={start:R.skipHiddenDays(u),end:R.skipHiddenDays(M,-1,!0)};let h=pt({currentRange:b,snapToWeek:!0,fixedWeekCount:o,dateEnv:i});h={start:R.skipHiddenDays(h.start),end:R.skipHiddenDays(h.end,-1,!0)};const k=n.activeRange?bt(n.activeRange,d?h:b):null;v.push({currentDate:n.currentDate,isValid:n.isValid,validRange:n.validRange,renderRange:h,activeRange:k,currentRange:b,currentRangeUnit:"month",isRangeAllDay:!0,dateIncrement:n.dateIncrement,slotMinTime:n.slotMaxTime,slotMaxTime:n.slotMinTime}),u=M}return v}const Nt=Y({year:"numeric",month:"long"}),Wt=Y({month:"long"});function Pt(R,n){return R||(n[0].currentRange.start.getUTCFullYear()!==n[n.length-1].currentRange.start.getUTCFullYear()?Nt:Wt)}const zt={multiMonthTitleFormat:Y,multiMonthMaxColumns:Number,multiMonthMinWidth:Number};var Ot=".fc .fc-multimonth{border:1px solid var(--fc-border-color);display:flex;flex-wrap:wrap;overflow-x:hidden;overflow-y:auto}.fc .fc-multimonth-title{font-size:1.2em;font-weight:700;padding:1em 0;text-align:center}.fc .fc-multimonth-daygrid{background:var(--fc-page-bg-color)}.fc .fc-multimonth-daygrid-table,.fc .fc-multimonth-header-table{table-layout:fixed;width:100%}.fc .fc-multimonth-daygrid-table{border-top-style:hidden!important}.fc .fc-multimonth-singlecol .fc-multimonth{position:relative}.fc .fc-multimonth-singlecol .fc-multimonth-header{background:var(--fc-page-bg-color);position:relative;top:0;z-index:2}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid{position:relative;z-index:1}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid-table,.fc .fc-multimonth-singlecol .fc-multimonth-header-table{border-left-style:hidden;border-right-style:hidden}.fc .fc-multimonth-singlecol .fc-multimonth-month:last-child .fc-multimonth-daygrid-table{border-bottom-style:hidden}.fc .fc-multimonth-multicol{line-height:1}.fc .fc-multimonth-multicol .fc-multimonth-month{padding:0 1.2em 1.2em}.fc .fc-multimonth-multicol .fc-daygrid-more-link{border:1px solid var(--fc-event-border-color);display:block;float:none;padding:1px}.fc .fc-multimonth-compact{line-height:1}.fc .fc-multimonth-compact .fc-multimonth-daygrid-table,.fc .fc-multimonth-compact .fc-multimonth-header-table{font-size:.9em}.fc-media-screen .fc-multimonth-singlecol .fc-multimonth-header{position:sticky}.fc-media-print .fc-multimonth{overflow:visible}";ut(Ot);var Ft=mt({name:"@fullcalendar/multimonth",initialView:"multiMonthYear",optionRefiners:zt,views:{multiMonth:{component:_t,dateProfileGeneratorClass:ht,multiMonthMinWidth:350,multiMonthMaxColumns:3},multiMonthYear:{type:"multiMonth",duration:{years:1},fixedWeekCount:!0,showNonCurrentDates:!1}}});const Vt={class:"calendar-container"},Bt={class:"modal-header"},Yt={style:{display:"flex","flex-direction":"column"}},At={class:"modal-body"},It={class:"booking-detail"},jt={class:"value"},qt={class:"booking-detail"},Ut={class:"value"},Lt={class:"booking-detail"},Gt={class:"value"},Jt={class:"booking-detail"},Kt={class:"value"},Qt={class:"booking-detail"},Xt={class:"value"},Zt={class:"booking-detail"},te={class:"value"},ee={class:"booking-detail column"},ne={class:"value"},se={class:"booking-detail column"},oe=["innerHTML"],le={__name:"CalendarView",setup(R){const n=$([]),i=$([]),o=$(null),d=e=>{if(!e)return{start:null,end:null};try{const[t,r]=e.split("-"),[l,g]=t.split("T"),[c,m,f]=l.split("."),C=`${`20${f}`}-${m}-${c}T${g}:00`,[S,_]=r.split("T"),[T,I,P]=S.split("."),X=`${`20${P}`}-${I}-${T}T${_}:00`;return{start:C,end:X}}catch(t){return console.error("Error parsing date:",e,t),{start:null,end:null}}},a=e=>{if(!e)return"Не вказано";try{const{start:t,end:r}=d(e);if(!t||!r)return e;const l=new Date(t),g=new Date(r),c={day:"2-digit",month:"2-digit",year:"numeric"},m={hour:"2-digit",minute:"2-digit"},f=l.toLocaleDateString("uk-UA",c),x=l.toLocaleTimeString("uk-UA",m),C=g.toLocaleDateString("uk-UA",c),S=g.toLocaleTimeString("uk-UA",m);return`${f}, ${x} - ${C}, ${S}`}catch{return e}},y=e=>({left:"#54cf6c",right:"grey",family:"#3e82dc"})[e]||"#9E9E9E",u=e=>{const t=n.value.find(r=>r.$id===e);return t?`${t.alias}`.trim():e},v=e=>({lazni:"Лазня",house:"Будинок на добу",pool:"Басейн",massage:"Масаж",room:"Кімната"})[e]||e,M=e=>({family:"Family House",left:"River View Left",right:"River View Right"})[e]||e;function b(e){return JSON.parse(e).g?JSON.parse(e).g:"-"}function h(e){return JSON.parse(e).d?JSON.parse(e).d:"-"}function k(e){try{const t=JSON.parse(e);if(!t.l&&!t.c)return"-";const r={h:"Хвоя",c:"Цитрус",t:"Трави"},l={},g=(m,f,x=!1)=>{m&&m.split("|").forEach(C=>{const[S,_,T]=C.split(":");if(l[S]||(l[S]={sauna:null,bath:null,fills:[]}),f==="Лазня"&&(l[S].sauna=_),f==="Чан"&&(l[S].bath=_,T)){const P=(T.includes(",")?T.split(","):T.split("")).map(z=>r[z.trim()]||z.trim());l[S].fills.push(...P)}})};g(t.l.l,"Лазня"),g(t.l.c,"Чан");const c=[];return Object.keys(l).sort().forEach(m=>{const f=l[m];if(c.push(`<b>${m}</b>`),f.sauna&&c.push(`Лазня на ${f.sauna} год`),f.bath&&c.push(`Чан на ${f.bath} год`),f.fills.length){const x=[...new Set(f.fills)];c.push(`Наповнення: ${x.join(", ")}`)}}),c.join("<br>")}catch{return"-"}}const H=Z(()=>i.value.map(e=>{const t=u(e.guest),{start:r,end:l}=d(e.date);return!r||!l?(console.warn("Invalid date format for booking:",e),null):{id:e.$id,title:`${t}`,start:r,end:l,backgroundColor:y(e.house),borderColor:y(e.house),extendedProps:{booking:e,guestName:t,type:e.type,house:e.house}}}).filter(e=>e!==null)),N=e=>{o.value=e.event.extendedProps.booking},E=e=>{U.push({name:"CreateBooking",query:{date:e.dateStr}})},W=e=>{U.push({name:"CreateBooking",query:{start:e.startStr,end:e.endStr}})},w=e=>{const t=new Date(e),r=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getFullYear()).slice(-2),c=String(t.getHours()).padStart(2,"0"),m=String(t.getMinutes()).padStart(2,"0");return`${r}.${l}.${g}T${c}:${m}`},K=async e=>{const t=e.event.extendedProps.booking,{start:r}=d(t.date),l=w(e.event.end),g=`${w(r)}-${l}`;try{await O.bookings.update(t.$id,{date:g}),V.success("Тривалість бронювання оновлено");const c=i.value.findIndex(m=>m.$id===t.$id);c!==-1&&(i.value[c].date=g)}catch(c){console.error("Error updating booking:",c),V.error("Помилка при оновленні тривалості"),e.revert()}},A=()=>{o.value=null},Q=$({plugins:[Tt,wt,Ft],initialView:"timeGridWeek",locale:kt,headerToolbar:{left:"prev,next today",center:"title",right:"multiMonthYear,dayGridMonth,timeGridWeek,timeGridDay"},buttonText:{today:"Сьогодні",month:"Місяць",week:"Тиждень",day:"День",multiMonthYear:"Рік"},slotMinTime:"06:00:00",slotMaxTime:"24:00:00",allDaySlot:!1,events:H,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,height:"auto",eventClick:N,dateClick:E,select:W,eventResize:K});return tt(async()=>{et({title:"Календар"});try{const e=await O.bookings.list();i.value=e.bookings;const t=await O.guests.list();n.value=t.guests}catch(e){console.error("Error loading data:",e),V.error("Помилка при завантаженні даних")}}),(e,t)=>{const r=st("router-link");return q(),nt(ct,null,{default:j(()=>[t[11]||(t[11]=s("p",{class:"comment"},"Календар",-1)),s("div",Vt,[F(it(Dt),{options:Q.value},null,8,["options"])]),o.value?(q(),ot("div",{key:0,class:"modal-overlay",onClick:A},[s("div",{class:"modal-content",onClick:t[0]||(t[0]=at(()=>{},["stop"]))},[s("div",Bt,[s("div",Yt,[t[1]||(t[1]=s("h3",null,"Бронювання",-1)),s("small",null,"#"+D(o.value.$id),1)]),s("button",{class:"close-btn",onClick:A},t[2]||(t[2]=[s("span",null," × ",-1)]))]),s("div",At,[s("div",It,[t[3]||(t[3]=s("span",{class:"label"},"Гість:",-1)),s("span",jt,[F(r,{to:`/guests/${o.value.guest}`},{default:j(()=>[rt(D(u(o.value.guest)),1)]),_:1},8,["to"])])]),s("div",qt,[t[4]||(t[4]=s("span",{class:"label"},"Тип:",-1)),s("span",Ut,D(v(o.value.type)),1)]),s("div",Lt,[t[5]||(t[5]=s("span",{class:"label"},"Будинок:",-1)),s("span",Gt,D(M(o.value.house)),1)]),s("div",Jt,[t[6]||(t[6]=s("span",{class:"label"},"К-сть гостей:",-1)),s("span",Kt,D(b(o.value.meta)),1)]),s("div",Qt,[t[7]||(t[7]=s("span",{class:"label"},"Дата та час:",-1)),s("span",Xt,D(a(o.value.date)),1)]),s("div",Zt,[t[8]||(t[8]=s("span",{class:"label"},"Договір:",-1)),s("span",te,[F(xt,{booking:o.value,guest:n.value.filter(l=>l.$id==o.value.guest)[0]},null,8,["booking","guest"])])]),s("div",ee,[t[9]||(t[9]=s("span",{class:"label"},"Коментар",-1)),s("span",ne,D(h(o.value.meta)),1)]),s("div",se,[t[10]||(t[10]=s("span",{class:"label"},"Лазня / чан",-1)),s("span",{class:"value",innerHTML:k(o.value.meta)},null,8,oe)])])])])):lt("",!0)]),_:1})}}},pe=Ct(le,[["__scopeId","data-v-5ee9ff2c"]]);export{pe as default};
