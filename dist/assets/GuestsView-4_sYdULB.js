import{a as r,q as w,B as O,f as j,x as H,g as x,e as A,j as B,y as J,o as t,b as l,w as G,C as h,l as I,D as f,t as d,c as o,F as E,E as D,n as L,d as v,G as P}from"./index-BHK97qKn.js";import{A as Q}from"./AdminView-isQXQewP.js";/* empty css                  */import{t as N}from"./toastr-CY63SwY8.js";/* empty css                 */import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Icon-Ld9IDNsz.js";import"./_commonjsHelpers-CqkleIqs.js";const K={id:"guest",class:"modal"},R={class:"form-input"},X={class:"form-input"},Y={style:{width:"100%","text-align":"end"}},Z={class:"form-input"},ee={class:"form-input"},ae={class:"form-input"},le={class:"select-input"},te=["onClick"],se={class:"modal-action"},oe=["disabled"],ne={class:"header"},ie={class:"header__search"},re={class:"form-input"},de={key:0,style:{width:"fit-content"},class:"primary",onclick:"guest.showModal()"},ue={class:"guests"},ce={key:0,class:"not-found"},ve={class:"guest-text"},_e={class:"guest__avatar"},me={class:"guest__avatar__count"},pe=["src"],he=["src"],fe={key:2,class:"guest__avatar",src:"  https://ui-avatars.com/api/?name=••/&background=ccc&color=808080"},ye=["src"],be={key:4,class:"guest__avatar__bookings"},ke={key:5,class:"guest__avatar__badge"},ge={key:6,class:"guest__avatar__badge"},we={class:"guest__info"},xe={key:0,class:"guest__name placeholder"},$e={key:1,class:"guest__name"},Ce={key:2,class:"guest__id placeholder"},Ve={key:3,class:"guest__id"},Se={key:4,class:"guest__id"},Ae={__name:"GuestsView",setup(Be){const $=r([]),_=r(Array.from({length:10},()=>({}))),m=r(""),C=r(!0),k=r(!1),{user:V}=O(),U=w(()=>{var n;return(n=V.value)!=null&&n.teams?V.value.teams.some(a=>{var c;try{const i=typeof a.prefs=="string"?JSON.parse(a.prefs):a.prefs;return(c=i==null?void 0:i.guests)==null?void 0:c.includes("create")}catch{return!1}}):!1}),S=w(()=>[..._.value].reverse()),s=r({alias:null,tg:null,ig:null,description:null,source:null}),q=w(()=>!!(k.value||!s.value.alias||!s.value.source)),y=r([]);function z(){s.value={alias:null,name:null,birthday:null,document:null,phone:null},k.value=!1,document.getElementById("guest").close()}async function M(){k.value=!0,x.guests.create(s.value).then(n=>{s.value={alias:null,name:null,birthday:null,document:null,phone:null},window.location.href=`/guests/${n.guest.$id}`}).catch(n=>{N.error("Не вдалося створити гостя")})}r("l"),j(()=>{H({title:"Гості"}),sessionStorage.getItem("guest-error")=="get-error"&&(N.error("Помилка завантаження гостя"),sessionStorage.removeItem("guest-error")),x.guests.list().then(a=>{$.value=a.guests,_.value=a.guests,C.value=!1}),x.bookings.list().then(a=>{const c=a.bookings;_.value.forEach(i=>{let p=0;c.forEach(b=>{b.guest==i.$id&&(p+=1)}),i.bookings=p})})});function T(){s.value.alias=m.value.trim(),_.value=$.value.filter(n=>String(n.alias).toLowerCase().includes(String(m.value.trim()).toLowerCase())||String(n.name).toLowerCase().includes(String(m.value.trim()).toLowerCase()))}const F=r([{label:"Instagram",value:"i"},{label:"Telegram",value:"tg"},{label:"Viber",value:"v"},{label:"WhatsApp",value:"w"},{label:"Телефон",value:"t"}]);return(n,a)=>{const c=J("router-link");return t(),A(Q,null,{default:B(()=>{var i,p,b;return[l("dialog",K,[l("form",{class:"modal-box",onSubmit:a[6]||(a[6]=G(e=>M(),["prevent"]))},[a[14]||(a[14]=l("h3",{class:"text-lg font-bold"},"Додати гостя",-1)),l("div",R,[a[9]||(a[9]=l("label",{class:"required"},[I("Ім'я "),l("span",null,"*")],-1)),h(l("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.value.alias=e),minlength:"1",required:""},null,512),[[f,s.value.alias]])]),l("div",X,[a[10]||(a[10]=l("label",{for:""},"Коментар",-1)),h(l("textarea",{style:{height:"8rem"},type:"text",maxlength:"100","onUpdate:modelValue":a[1]||(a[1]=e=>s.value.description=e),minlength:"1"},null,512),[[f,s.value.description]]),l("div",Y,[l("small",null,d((p=(i=s.value)==null?void 0:i.description)==null?void 0:p.length)+"/100",1)])]),l("div",Z,[a[11]||(a[11]=l("label",{for:""},"Telegram",-1)),h(l("input",{type:"text",placeholder:"@laznikyiv","onUpdate:modelValue":a[2]||(a[2]=e=>s.value.tg=e),minlength:"1"},null,512),[[f,s.value.tg]])]),l("div",ee,[a[12]||(a[12]=l("label",{for:""},"Instagram",-1)),h(l("input",{type:"text",placeholder:"@laznikyiv","onUpdate:modelValue":a[3]||(a[3]=e=>s.value.ig=e),minlength:"1"},null,512),[[f,s.value.ig]])]),l("div",ae,[a[13]||(a[13]=l("label",{class:"required"},[I("Джерело "),l("span",null,"*")],-1)),l("div",le,[(t(!0),o(E,null,D(F.value,e=>(t(),o("button",{key:e.value,type:"button",class:L(["house",{selected:s.value.source===e.value}]),onClick:g=>s.value.source=e.value},d(e.label),11,te))),128))])]),l("div",se,[l("button",{class:"secondary",onClick:[a[4]||(a[4]=G(()=>{},["prevent"])),a[5]||(a[5]=e=>z())]},"Скасувати"),l("button",{type:"submit",disabled:q.value},"Зберегти",8,oe)])],32)]),l("div",ne,[a[15]||(a[15]=l("p",{class:"comment"},"Гості",-1)),l("div",ie,[l("div",re,[h(l("input",{type:"",placeholder:"Пошук","onUpdate:modelValue":a[7]||(a[7]=e=>m.value=e),onInput:a[8]||(a[8]=e=>T())},null,544),[[f,m.value]])]),U.value?(t(),o("button",de," + Додати гостя ")):v("",!0)])]),l("div",ue,[_.value.length==0?(t(),o("p",ce,"Немає результатів")):v("",!0),((b=S.value)==null?void 0:b.length)>0?(t(!0),o(E,{key:1},D(S.value,(e,g)=>(t(),A(c,{to:"/guests/"+(e==null?void 0:e.$id)+"/",class:L(["guest",{lorem:C.value}]),style:P(`animation-delay: ${.02*g}s`)},{default:B(()=>[l("div",ve,[l("div",_e,[l("span",me,"№"+d(g+1),1),(e==null?void 0:e.b)==="t"?(t(),o("img",{key:0,class:"guest__avatar",src:`https://ui-avatars.com/api/?name=${e==null?void 0:e.alias}/&background=ccc&color=grey`},null,8,pe)):(e==null?void 0:e.b)==="p"?(t(),o("img",{key:1,class:"guest__avatar",src:`https://ui-avatars.com/api/?name=${e==null?void 0:e.alias}/&background=E1B33F75&color=daa520`},null,8,he)):e!=null&&e.alias?(t(),o("img",{key:3,class:"guest__avatar",src:`https://ui-avatars.com/api/?name=${e==null?void 0:e.alias}/&background=3D90864A&color=1d464`},null,8,ye)):(t(),o("img",fe)),e.bookings>0?(t(),o("span",be,d(e.bookings),1)):v("",!0),y.value.filter(u=>u.g===(e==null?void 0:e.$id)).length>0&&y.value.filter(u=>u.g===(e==null?void 0:e.$id)).length<99?(t(),o("span",ke,d(y.value.filter(u=>u.g===(e==null?void 0:e.$id)).length),1)):y.value.filter(u=>u.g===(e==null?void 0:e.$id)).length>0?(t(),o("span",ge,"99+ ")):v("",!0)])]),l("div",we,[e!=null&&e.alias?(t(),o("div",$e,d(e==null?void 0:e.alias),1)):(t(),o("div",xe," 123123123123123 ")),e!=null&&e.alias?v("",!0):(t(),o("div",Ce," 123123123123 ")),e.name&&e.name!=="None"?(t(),o("div",Ve,d((e==null?void 0:e.name)||"-"),1)):(t(),o("div",Se,d("-")))])]),_:2},1032,["to","style","class"]))),256)):v("",!0)])]}),_:1})}}},ze=W(Ae,[["__scopeId","data-v-fa51d415"]]);export{ze as default};
