import{a as v,q as B,s as tt,c as W,o as J,b as e,i as y,n as P,t as g,f as U,x as st,g as j,e as et,j as K,y as at,d as nt,u as ot,w as rt,l as lt,z as Q}from"./index-DfC6sHtH.js";import{t as H}from"./toastr-CY63SwY8.js";/* empty css                   */import{A as it}from"./AdminView-DgyvBQoU.js";/* empty css                  */import{D as ct}from"./DogovirActions-dr_83eGJ.js";import{_ as I}from"./Icon-CMnBudPe.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{F as ut,l as dt,i as gt,a as pt}from"./uk-DVrgmjrh.js";import"./_commonjsHelpers-CqkleIqs.js";const vt={class:"stats-cards"},ft={class:"stats-card"},ht={class:"stats-card__header"},mt={class:"stats-card__icon"},_t={class:"stats-card__count"},yt={class:"stats-card"},Dt={class:"stats-card__header"},$t={class:"stats-card__icon"},bt={class:"stats-card__count"},kt={class:"stats-card"},St={class:"stats-card__header"},wt={class:"stats-card__icon"},Mt={class:"stats-card__count"},Tt={__name:"DashboardStatsCards",props:{guests:{type:Array,default:()=>[]},bookings:{type:Array,default:()=>[]}},setup(L){const _=L,p=v(0),i=v(0),f=v(0),D=v(0),b=v(0),k=v(0),x=B(()=>p.value-i.value),C=B(()=>f.value-D.value),E=B(()=>{const a=N(30),n=N(60)-a;return a-n});function S(a){return a>0?`+${a}`:a<0?`${a}`:"0"}function w(a){return a>0?"positive-diff":a<0?"negative-diff":"neutral-diff"}function M(a){const[n]=a.split("-"),[s]=n.split("T"),[t,o,r]=s.split(".");return`20${r}-${o}-${t}`}function Y(a){try{const n=typeof a.meta=="string"?JSON.parse(a.meta):a.meta||{};return n.g||n.guests||0}catch{return 0}}function N(a){const n=new Date;return n.setDate(n.getDate()-a),_.bookings.reduce((s,t)=>{try{if(new Date(M(t.date))>=n)return s+Y(t)}catch{console.error("Error parsing booking date:",t.date)}return s},0)}tt(()=>_.bookings,a=>{if(!a||!a.length){R();return}V(a),O(a),G(a)},{immediate:!0});function R(){p.value=0,i.value=0,f.value=0,D.value=0,b.value=0,k.value=0}function V(a){const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()-1);const t=s.toISOString().split("T")[0];p.value=0,i.value=0,a.forEach(o=>{try{const r=M(o.date);r===n?p.value++:r===t&&i.value++}catch{console.error("Error parsing booking date for today:",o.date)}})}function O(a){const n=new Date,s=n.getFullYear(),t=n.getMonth(),o=new Date(n);o.setMonth(o.getMonth()-1);const r=o.getFullYear(),d=o.getMonth();f.value=0,D.value=0,a.forEach(l=>{try{const c=new Date(M(l.date)),u=c.getFullYear(),m=c.getMonth();u===s&&m===t?f.value++:u===r&&m===d&&D.value++}catch{console.error("Error parsing booking date for month:",l.date)}})}function G(a){b.value=a.reduce((o,r)=>o+Y(r),0);const n=new Date;n.setDate(n.getDate()-30);const s=new Date;s.setDate(s.getDate()-60);let t=0;k.value=t}return(a,n)=>(J(),W("div",vt,[e("div",ft,[e("div",ht,[e("div",mt,[y(I,{icon:"calendar-white"})]),e("span",{class:P(w(x.value))},g(S(x.value)),3)]),n[0]||(n[0]=e("br",null,null,-1)),e("h3",_t,g(p.value),1),n[1]||(n[1]=e("p",{class:"stats-card__title"}," Бронювань сьогодні ",-1))]),e("div",yt,[e("div",Dt,[e("div",$t,[y(I,{icon:"calendar-white"})]),e("span",{class:P(w(C.value))},g(S(C.value)),3)]),n[2]||(n[2]=e("br",null,null,-1)),e("h3",bt,g(f.value),1),n[3]||(n[3]=e("p",{class:"stats-card__title"}," Бронювань цього місяця ",-1))]),e("div",kt,[e("div",St,[e("div",wt,[y(I,{icon:"guests-white"})]),e("span",{class:P(w(E.value))},g(S(E.value)),3)]),n[4]||(n[4]=e("br",null,null,-1)),e("h3",Mt,g(L.guests.length),1),n[5]||(n[5]=e("p",{class:"stats-card__title"}," Загальна кількість гостей ",-1))])]))}},xt=X(Tt,[["__scopeId","data-v-d569350a"]]),Ct={class:"calendar-container"},Et={class:"modal-header"},Yt={style:{display:"flex","flex-direction":"column"}},Nt={class:"modal-body"},Ot={class:"booking-detail"},At={class:"value"},Bt={class:"booking-detail"},Lt={class:"value"},Rt={class:"booking-detail"},Vt={class:"value"},Gt={class:"booking-detail"},Ft={class:"value"},zt={class:"booking-detail"},Pt={class:"value"},jt={class:"booking-detail"},Ht={class:"value"},It={class:"booking-detail column"},Jt={class:"value"},qt={class:"booking-detail column"},Ut=["innerHTML"],Kt={__name:"DashboardView",setup(L){const _=v([]),p=v([]),i=v(null),f=s=>{if(!s)return{start:null,end:null};try{const[t,o]=s.split("-"),[r,d]=t.split("T"),[l,c,u]=r.split("."),T=`${`20${u}`}-${c}-${l}T${d}:00`,[h,A]=o.split("T"),[$,q,F]=h.split("."),Z=`${`20${F}`}-${q}-${$}T${A}:00`;return{start:T,end:Z}}catch(t){return console.error("Error parsing date:",s,t),{start:null,end:null}}},D=s=>{if(!s)return"Не вказано";try{const{start:t,end:o}=f(s);if(!t||!o)return s;const r=new Date(t),d=new Date(o),l={day:"2-digit",month:"2-digit",year:"numeric"},c={hour:"2-digit",minute:"2-digit"},u=r.toLocaleDateString("uk-UA",l),m=r.toLocaleTimeString("uk-UA",c),T=d.toLocaleDateString("uk-UA",l),h=d.toLocaleTimeString("uk-UA",c);return`${u}, ${m} - ${T}, ${h}`}catch{return s}},b=s=>({left:"#54cf6c",right:"grey",family:"#3e82dc"})[s]||"#9E9E9E",k=s=>{const t=_.value.find(o=>o.$id===s);return t?`${t.alias}`.trim():s},x=s=>({lazni:"Лазня",house:"Будинок на добу",pool:"Басейн",massage:"Масаж",room:"Кімната"})[s]||s,C=s=>({family:"Family House",left:"River View Left",right:"River View Right"})[s]||s;function E(s){return JSON.parse(s).g?JSON.parse(s).g:"-"}function S(s){return JSON.parse(s).d?JSON.parse(s).d:"-"}function w(s){try{const t=JSON.parse(s);if(!t.l&&!t.c)return"-";const o={h:"Хвоя",c:"Цитрус",t:"Трави"},r={},d=(c,u,m=!1)=>{c&&c.split("|").forEach(T=>{const[h,A,$]=T.split(":");if(r[h]||(r[h]={sauna:null,bath:null,fills:[]}),u==="Лазня"&&(r[h].sauna=A),u==="Чан"&&(r[h].bath=A,$)){const F=($.includes(",")?$.split(","):$.split("")).map(z=>o[z.trim()]||z.trim());r[h].fills.push(...F)}})};d(t.l.l,"Лазня"),d(t.l.c,"Чан");const l=[];return Object.keys(r).sort().forEach(c=>{const u=r[c];if(l.push(`<b>${c}</b>`),u.sauna&&l.push(`Лазня на ${u.sauna} год`),u.bath&&l.push(`Чан на ${u.bath} год`),u.fills.length){const m=[...new Set(u.fills)];u.fills.join("")!=="null"&&l.push(`Наповнення: ${m.join(", ")}`)}}),l.join("<br>")}catch{return"-"}}const M=v({});U(()=>{fetch("https://api.laznikyiv.com/v2/services",{credentials:"include"}).then(s=>s.json().then(t=>{M.value=t,console.log(t)}))});const Y=B(()=>p.value.map(s=>{const t=k(s.guest),{start:o,end:r}=f(s.date);return!o||!r?(console.warn("Invalid date format for booking:",s),null):{id:s.$id,title:`${t}`,start:o,end:r,backgroundColor:b(s.house),borderColor:b(s.house),extendedProps:{booking:s,guestName:t,type:s.type,house:s.house}}}).filter(s=>s!==null)),N=s=>{i.value=s.event.extendedProps.booking},R=s=>{Q.push({name:"CreateBooking",query:{date:s.dateStr}})},V=s=>{Q.push({name:"CreateBooking",query:{start:s.startStr,end:s.endStr}})},O=s=>{const t=new Date(s),o=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getFullYear()).slice(-2),l=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return`${o}.${r}.${d}T${l}:${c}`},G=async s=>{const t=s.event.extendedProps.booking,{start:o}=f(t.date),r=O(s.event.end),d=`${O(o)}-${r}`;try{await j.bookings.update(t.$id,{date:d}),H.success("Тривалість бронювання оновлено");const l=p.value.findIndex(c=>c.$id===t.$id);l!==-1&&(p.value[l].date=d)}catch(l){console.error("Error updating booking:",l),H.error("Помилка при оновленні тривалості"),s.revert()}},a=()=>{i.value=null},n=v({plugins:[gt,pt],initialView:"timeGridDay",locale:dt,buttonText:{today:"Сьогодні",month:"Місяць",week:"Тиждень",day:"День",multiMonthYear:"Рік"},slotMinTime:"06:00:00",slotMaxTime:"24:00:00",allDaySlot:!1,events:Y,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,height:"auto",eventClick:N,dateClick:R,select:V,eventResize:G});return U(async()=>{st({title:"Огляд"});try{const s=await j.bookings.list();p.value=s.bookings;const t=await j.guests.list();_.value=t.guests}catch(s){console.error("Error loading data:",s),H.error("Помилка при завантаженні даних")}}),(s,t)=>{const o=at("router-link");return J(),et(it,null,{default:K(()=>[t[11]||(t[11]=e("p",{class:"comment"},"Огляд",-1)),y(xt,{bookings:p.value,guests:_.value},null,8,["bookings","guests"]),e("div",Ct,[y(ot(ut),{options:n.value},null,8,["options"])]),i.value?(J(),W("div",{key:0,class:"modal-overlay",onClick:a},[e("div",{class:"modal-content",onClick:t[0]||(t[0]=rt(()=>{},["stop"]))},[e("div",Et,[e("div",Yt,[t[1]||(t[1]=e("h3",null,"Бронювання",-1)),e("small",null,"#"+g(i.value.$id),1)]),e("button",{class:"close-btn",onClick:a},t[2]||(t[2]=[e("span",null," × ",-1)]))]),e("div",Nt,[e("div",Ot,[t[3]||(t[3]=e("span",{class:"label"},"Гість:",-1)),e("span",At,[y(o,{to:`/guests/${i.value.guest}`},{default:K(()=>[lt(g(k(i.value.guest)),1)]),_:1},8,["to"])])]),e("div",Bt,[t[4]||(t[4]=e("span",{class:"label"},"Тип:",-1)),e("span",Lt,g(x(i.value.type)),1)]),e("div",Rt,[t[5]||(t[5]=e("span",{class:"label"},"Будинок:",-1)),e("span",Vt,g(C(i.value.house)),1)]),e("div",Gt,[t[6]||(t[6]=e("span",{class:"label"},"К-сть гостей:",-1)),e("span",Ft,g(E(i.value.meta)),1)]),e("div",zt,[t[7]||(t[7]=e("span",{class:"label"},"Дата та час:",-1)),e("span",Pt,g(D(i.value.date)),1)]),e("div",jt,[t[8]||(t[8]=e("span",{class:"label"},"Договір:",-1)),e("span",Ht,[y(ct,{booking:i.value,guest:_.value.filter(r=>r.$id==i.value.guest)[0]},null,8,["booking","guest"])])]),e("div",It,[t[9]||(t[9]=e("span",{class:"label"},"Коментар",-1)),e("span",Jt,g(S(i.value.meta)),1)]),e("div",qt,[t[10]||(t[10]=e("span",{class:"label"},"Лазня / чан",-1)),e("span",{class:"value",innerHTML:w(i.value.meta)},null,8,Ut)])])])])):nt("",!0)]),_:1})}}},rs=X(Kt,[["__scopeId","data-v-6daa1814"]]);export{rs as default};
