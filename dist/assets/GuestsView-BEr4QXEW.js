import{b as _,m as C,D as z,d as D,s as I,e as k,x as G,j as $,l as M,y as F,o as t,f as a,c as e,z as d,w as O,h as v,v as p,F as A,E as L,t as n,g as T,G as j,q}from"./index-Djdg4anx.js";import{A as H}from"./AdminView-zm1vYfoj.js";import{t as J}from"./toastr-CY63SwY8.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";const Q={id:"guest",class:"modal"},R={class:"form-input"},P={class:"form-input"},W={class:"form-input"},X={class:"form-input"},Y={class:"form-input"},Z={class:"header"},g={class:"header__search"},ll={class:"form-input"},al={key:0,style:{width:"fit-content"},class:"primary",onclick:"guest.showModal()"},ol={key:0,class:"guests"},tl={key:1,class:"guests"},el={key:0,class:"not-found"},sl={class:"guest-text"},nl={class:"guest__avatar"},rl={class:"guest__avatar__count"},il=["src"],dl=["src"],ul={key:2,class:"guest__avatar",src:"  https://ui-avatars.com/api/?name=••/&background=ccc&color=808080"},cl=["src"],_l={key:4,class:"guest__avatar__bookings"},ml={key:5,class:"guest__avatar__badge"},vl={key:6,class:"guest__avatar__badge"},pl={class:"guest__info"},hl={key:0,class:"guest__name placeholder"},fl={key:1,class:"guest__name"},yl={key:2,class:"guest__id placeholder"},bl={key:3,class:"guest__id"},kl={key:4,class:"guest__id"},$l={__name:"GuestsView",setup(wl){const w=_([]),h=_(Array.from({length:10},()=>({}))),f=_(""),x=_(!0),U=M(),{user:V}=z(),B=C(()=>{var r;return(r=V.value)!=null&&r.teams?V.value.teams.some(o=>{var u;try{const i=typeof o.prefs=="string"?JSON.parse(o.prefs):o.prefs;return(u=i==null?void 0:i.guests)==null?void 0:u.includes("create")}catch{return!1}}):!1}),b=C(()=>[...h.value].reverse()),s=_({alias:null,name:null,birthday:null,document:null,phone:null}),y=_([]);async function E(){k.guests.create(s.value).then(r=>{s.value={alias:null,name:null,birthday:null,document:null,phone:null},U.push(`/guests/${r.$id}`)})}const S=_("l");D(()=>{I({title:"Гості | Lazni Kyiv"}),sessionStorage.getItem("guest-error")=="get-error"&&(J.error("Помилка завантаження гостя"),sessionStorage.removeItem("guest-error")),k.guests.list().then(o=>{w.value=o.guests,h.value=o.guests,x.value=!1}),k.bookings.list().then(o=>{const u=o.bookings;h.value.forEach(i=>{let l=0;u.forEach(m=>{m.guest==i.$id&&(l+=1)}),i.bookings=l})})});function N(){s.value.alias=f.value.trim(),h.value=w.value.filter(r=>String(r.alias).toLowerCase().includes(String(f.value.trim()).toLowerCase())||String(r.name).toLowerCase().includes(String(f.value.trim()).toLowerCase()))}return(r,o)=>{const u=F("router-link");return t(),G(H,null,{default:$(()=>{var i;return[a("dialog",Q,[a("form",{class:"modal-box",onSubmit:O(E,["prevent"])},[o[12]||(o[12]=a("h3",{class:"text-lg font-bold mb-4"},"Додати бронювання",-1)),a("div",R,[o[7]||(o[7]=a("label",{for:""},"Ім'я",-1)),v(a("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=l=>s.value.alias=l)},null,512),[[p,s.value.alias]])]),a("div",P,[o[8]||(o[8]=a("label",{for:""},"ПІБ",-1)),v(a("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=l=>s.value.name=l)},null,512),[[p,s.value.name]])]),a("div",W,[o[9]||(o[9]=a("label",{for:""},"Номер телефону",-1)),v(a("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=l=>s.value.phone=l)},null,512),[[p,s.value.phone]])]),a("div",X,[o[10]||(o[10]=a("label",{for:""},"Дата народження",-1)),v(a("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=l=>s.value.birthday=l)},null,512),[[p,s.value.birthday]])]),a("div",Y,[o[11]||(o[11]=a("label",{for:""},"Документ",-1)),v(a("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=l=>s.value.document=l)},null,512),[[p,s.value.document]])]),o[13]||(o[13]=a("div",{class:"modal-action",style:{"margin-top":"0.5rem"}},[a("button",{class:"secondary",type:"button",onclick:"guest.close()"},"Скасувати"),a("button",{type:"submit"},"Додати")],-1))],32)]),a("div",Z,[o[14]||(o[14]=a("p",{class:"comment"},"Гості",-1)),a("div",g,[a("div",ll,[v(a("input",{type:"",placeholder:"Пошук","onUpdate:modelValue":o[5]||(o[5]=l=>f.value=l),onInput:o[6]||(o[6]=l=>N())},null,544),[[p,f.value]])]),B.value?(t(),e("button",al," + Додати гостя ")):d("",!0)])]),S.value=="g"?(t(),e("div",ol,[a("table",null,[o[15]||(o[15]=a("thead",null,[a("th",null,"№"),a("th",null,"Ім'я"),a("th",null,"ПІБ"),a("th",null,"ДН"),a("th",null,"Номер тел."),a("th",null,"Паспорт")],-1)),a("tbody",null,[(t(!0),e(A,null,L(b.value,(l,m)=>(t(),e("tr",null,[a("td",null,n(m+1),1),a("td",null,[T(u,{to:`./${l.$id}/`},{default:$(()=>[a("u",null,n(l.alias),1)]),_:2},1032,["to"])]),a("td",null,n(l.name),1),a("td",null,n(l==null?void 0:l.birthday),1),a("td",null,n(l==null?void 0:l.phone),1),a("td",null,n(l==null?void 0:l.document),1)]))),256))])])])):d("",!0),S.value=="l"?(t(),e("div",tl,[h.value.length==0?(t(),e("p",el,"Немає результатів")):d("",!0),((i=b.value)==null?void 0:i.length)>0?(t(!0),e(A,{key:1},L(b.value,(l,m)=>(t(),G(u,{to:"/guests/"+(l==null?void 0:l.$id)+"/",class:q(["guest",{lorem:x.value}]),style:j(`animation-delay: ${.02*m}s`)},{default:$(()=>[a("div",sl,[a("div",nl,[a("span",rl,"№"+n(m+1),1),(l==null?void 0:l.b)==="t"?(t(),e("img",{key:0,class:"guest__avatar",src:`https://ui-avatars.com/api/?name=${l==null?void 0:l.alias}/&background=ccc&color=grey`},null,8,il)):(l==null?void 0:l.b)==="p"?(t(),e("img",{key:1,class:"guest__avatar",src:`https://ui-avatars.com/api/?name=${l==null?void 0:l.alias}/&background=E1B33F75&color=daa520`},null,8,dl)):l!=null&&l.alias?(t(),e("img",{key:3,class:"guest__avatar",src:`https://ui-avatars.com/api/?name=${l==null?void 0:l.alias}/&background=3D90864A&color=1d464`},null,8,cl)):(t(),e("img",ul)),l.bookings>0?(t(),e("span",_l,n(l.bookings),1)):d("",!0),y.value.filter(c=>c.g===(l==null?void 0:l.$id)).length>0&&y.value.filter(c=>c.g===(l==null?void 0:l.$id)).length<99?(t(),e("span",ml,n(y.value.filter(c=>c.g===(l==null?void 0:l.$id)).length),1)):y.value.filter(c=>c.g===(l==null?void 0:l.$id)).length>0?(t(),e("span",vl,"99+ ")):d("",!0)])]),a("div",pl,[l!=null&&l.alias?(t(),e("div",fl,n(l==null?void 0:l.alias),1)):(t(),e("div",hl," 123123123123123 ")),l!=null&&l.alias?d("",!0):(t(),e("div",yl," 123123123123 ")),l.name&&l.name!=="None"?(t(),e("div",bl,n((l==null?void 0:l.name)||"-"),1)):(t(),e("div",kl,n("-")))])]),_:2},1032,["to","style","class"]))),256)):d("",!0)])):d("",!0)]}),_:1})}}},Al=K($l,[["__scopeId","data-v-80aaf62e"]]);export{Al as default};
