import{b as _,m as tt,d as et,s as nt,e as H,x as st,j as q,y as ot,o as A,f as s,c as lt,z as it,g as I,u as at,w as rt,t as C,a as ct,A as U}from"./index-Djdg4anx.js";import{t as F}from"./toastr-CY63SwY8.js";/* empty css                   */import{A as dt}from"./AdminView-zm1vYfoj.js";import{c as ut,b as B,d as ht,e as mt,T as ft,D as Z,m as V,f as G,y as p,g as J,V as gt,h as pt,j as bt,k as vt,n as yt,o as kt,p as wt,q as Mt,r as Ct,F as Rt,l as St,i as xt,a as Dt}from"./uk-B5NPStY8.js";import{_ as Tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";class $t extends Z{constructor(){super(...arguments),this.buildDayTableModel=V(yt),this.slicer=new kt,this.state={labelId:wt()}}render(){const{props:n,state:l,context:o}=this,{dateProfile:d,forPrint:r}=n,{options:w}=o,u=this.buildDayTableModel(d,o.dateProfileGenerator),b=this.slicer.sliceProps(n,d,w.nextDayThreshold,o,u),y=n.tableWidth!=null?n.tableWidth/w.aspectRatio:null,v=u.cells.length,m=y!=null?y/v:null;return p("div",{ref:n.elRef,"data-date":n.isoDateStr,className:"fc-multimonth-month",style:{width:n.width},role:"grid","aria-labelledby":l.labelId},p("div",{className:"fc-multimonth-header",style:{marginBottom:m},role:"presentation"},p("div",{className:"fc-multimonth-title",id:l.labelId},o.dateEnv.format(n.dateProfile.currentRange.start,n.titleFormat)),p("table",{className:["fc-multimonth-header-table",o.theme.getClass("table")].join(" "),role:"presentation"},p("thead",{role:"rowgroup"},p(Ct,{dateProfile:n.dateProfile,dates:u.headerDates,datesRepDistinctDays:!1})))),p("div",{className:["fc-multimonth-daygrid","fc-daygrid","fc-daygrid-body",!r&&"fc-daygrid-body-balanced",r&&"fc-daygrid-body-unbalanced",r&&"fc-daygrid-body-natural"].join(" "),style:{marginTop:-m}},p("table",{className:["fc-multimonth-daygrid-table",o.theme.getClass("table")].join(" "),style:{height:r?"":y},role:"presentation"},p("tbody",{role:"rowgroup"},p(Mt,Object.assign({},b,{dateProfile:d,cells:u.cells,eventSelection:n.eventSelection,dayMaxEvents:!r,dayMaxEventRows:!r,showWeekNumbers:w.weekNumbers,clientWidth:n.clientWidth,clientHeight:n.clientHeight,forPrint:r}))))))}}class Et extends Z{constructor(){super(...arguments),this.splitDateProfileByMonth=V(Ht),this.buildMonthFormat=V(Pt),this.scrollElRef=G(),this.firstMonthElRef=G(),this.needsScrollReset=!1,this.handleSizing=n=>{n&&this.updateSize()}}render(){const{context:n,props:l,state:o}=this,{options:d}=n,{clientWidth:r,clientHeight:w}=o,u=o.monthHPadding||0,b=Math.min(r!=null?Math.floor(r/(d.multiMonthMinWidth+u)):1,d.multiMonthMaxColumns)||1,y=100/b+"%",v=r==null?null:r/b-u,m=r!=null&&b===1,R=this.splitDateProfileByMonth(n.dateProfileGenerator,l.dateProfile,n.dateEnv,m?!1:d.fixedWeekCount,d.showNonCurrentDates),N=this.buildMonthFormat(d.multiMonthTitleFormat,R),W=["fc-multimonth",m?"fc-multimonth-singlecol":"fc-multimonth-multicol",v!=null&&v<400?"fc-multimonth-compact":"",l.isHeightAuto?"":"fc-scroller"];return p(gt,{elRef:this.scrollElRef,elClasses:W,viewSpec:n.viewSpec},R.map((T,P)=>{const $=J(T.currentRange.start);return p($t,Object.assign({},l,{key:$,isoDateStr:$,elRef:P===0?this.firstMonthElRef:void 0,titleFormat:N,dateProfile:T,width:y,tableWidth:v,clientWidth:r,clientHeight:w}))}))}componentDidMount(){this.updateSize(),this.context.addResizeHandler(this.handleSizing),this.requestScrollReset()}componentDidUpdate(n){pt(n,this.props)||this.handleSizing(!1),n.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}updateSize(){const n=this.scrollElRef.current,l=this.firstMonthElRef.current;n&&this.setState({clientWidth:n.clientWidth,clientHeight:n.clientHeight}),l&&n&&this.state.monthHPadding==null&&this.setState({monthHPadding:n.clientWidth-l.firstChild.offsetWidth})}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.state.monthHPadding!=null){const{currentDate:n}=this.props.dateProfile,l=this.scrollElRef.current,o=l.querySelector(`[data-date="${J(n)}"]`);l.scrollTop=o.getBoundingClientRect().top-this.firstMonthElRef.current.getBoundingClientRect().top,this.needsScrollReset=!1}}shouldComponentUpdate(){return!0}}const _t=ut(1,"month");function Ht(k,n,l,o,d){const{start:r,end:w}=n.currentRange;let u=r;const b=[];for(;u.valueOf()<w.valueOf();){const y=l.add(u,_t),v={start:k.skipHiddenDays(u),end:k.skipHiddenDays(y,-1,!0)};let m=bt({currentRange:v,snapToWeek:!0,fixedWeekCount:o,dateEnv:l});m={start:k.skipHiddenDays(m.start),end:k.skipHiddenDays(m.end,-1,!0)};const R=n.activeRange?vt(n.activeRange,d?m:v):null;b.push({currentDate:n.currentDate,isValid:n.isValid,validRange:n.validRange,renderRange:m,activeRange:R,currentRange:v,currentRangeUnit:"month",isRangeAllDay:!0,dateIncrement:n.dateIncrement,slotMinTime:n.slotMaxTime,slotMaxTime:n.slotMinTime}),u=y}return b}const Nt=B({year:"numeric",month:"long"}),Wt=B({month:"long"});function Pt(k,n){return k||(n[0].currentRange.start.getUTCFullYear()!==n[n.length-1].currentRange.start.getUTCFullYear()?Nt:Wt)}const zt={multiMonthTitleFormat:B,multiMonthMaxColumns:Number,multiMonthMinWidth:Number};var Ot=".fc .fc-multimonth{border:1px solid var(--fc-border-color);display:flex;flex-wrap:wrap;overflow-x:hidden;overflow-y:auto}.fc .fc-multimonth-title{font-size:1.2em;font-weight:700;padding:1em 0;text-align:center}.fc .fc-multimonth-daygrid{background:var(--fc-page-bg-color)}.fc .fc-multimonth-daygrid-table,.fc .fc-multimonth-header-table{table-layout:fixed;width:100%}.fc .fc-multimonth-daygrid-table{border-top-style:hidden!important}.fc .fc-multimonth-singlecol .fc-multimonth{position:relative}.fc .fc-multimonth-singlecol .fc-multimonth-header{background:var(--fc-page-bg-color);position:relative;top:0;z-index:2}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid{position:relative;z-index:1}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid-table,.fc .fc-multimonth-singlecol .fc-multimonth-header-table{border-left-style:hidden;border-right-style:hidden}.fc .fc-multimonth-singlecol .fc-multimonth-month:last-child .fc-multimonth-daygrid-table{border-bottom-style:hidden}.fc .fc-multimonth-multicol{line-height:1}.fc .fc-multimonth-multicol .fc-multimonth-month{padding:0 1.2em 1.2em}.fc .fc-multimonth-multicol .fc-daygrid-more-link{border:1px solid var(--fc-event-border-color);display:block;float:none;padding:1px}.fc .fc-multimonth-compact{line-height:1}.fc .fc-multimonth-compact .fc-multimonth-daygrid-table,.fc .fc-multimonth-compact .fc-multimonth-header-table{font-size:.9em}.fc-media-screen .fc-multimonth-singlecol .fc-multimonth-header{position:sticky}.fc-media-print .fc-multimonth{overflow:visible}";ht(Ot);var Ft=mt({name:"@fullcalendar/multimonth",initialView:"multiMonthYear",optionRefiners:zt,views:{multiMonth:{component:Et,dateProfileGeneratorClass:ft,multiMonthMinWidth:350,multiMonthMaxColumns:3},multiMonthYear:{type:"multiMonth",duration:{years:1},fixedWeekCount:!0,showNonCurrentDates:!1}}});const Vt={class:"calendar-container"},Bt={class:"modal-header"},jt={style:{display:"flex","flex-direction":"column"}},Lt={class:"modal-body"},Yt={class:"booking-detail"},qt={class:"value"},At={class:"booking-detail"},It={class:"value"},Ut={class:"booking-detail"},Gt={class:"value"},Jt={class:"booking-detail"},Zt={class:"value"},Qt={class:"booking-detail"},Kt={class:"value"},Xt={class:"booking-detail"},te={class:"value"},ee={class:"booking-detail column"},ne={class:"value"},se={class:"booking-detail column"},oe=["innerHTML"],le={__name:"CalendarView",setup(k){const n=_([]),l=_([]),o=_(null),d=e=>{if(!e)return{start:null,end:null};try{const[t,a]=e.split("-"),[i,g]=t.split("T"),[c,h,f]=i.split("."),D=`${`20${f}`}-${h}-${c}T${g}:00`,[M,E]=a.split("T"),[S,Y,z]=M.split("."),X=`${`20${z}`}-${Y}-${S}T${E}:00`;return{start:D,end:X}}catch(t){return console.error("Error parsing date:",e,t),{start:null,end:null}}},r=e=>{if(!e)return"Не вказано";try{const{start:t,end:a}=d(e);if(!t||!a)return e;const i=new Date(t),g=new Date(a),c={day:"2-digit",month:"2-digit",year:"numeric"},h={hour:"2-digit",minute:"2-digit"},f=i.toLocaleDateString("uk-UA",c),x=i.toLocaleTimeString("uk-UA",h),D=g.toLocaleDateString("uk-UA",c),M=g.toLocaleTimeString("uk-UA",h);return`${f}, ${x} - ${D}, ${M}`}catch{return e}};function w(e,t){H.qr.get(e,t).then(a=>{window.open(`/qr/${a.token}`,"_blank")})}const u=e=>({left:"#54cf6c",right:"grey",family:"#3e82dc"})[e]||"#9E9E9E",b=e=>{const t=n.value.find(a=>a.$id===e);return t?`${t.alias}`.trim():e},y=e=>({lazni:"Лазня",house:"Будинок на добу",pool:"Басейн",massage:"Масаж",room:"Кімната"})[e]||e,v=e=>({family:"Family House",left:"River View Left",right:"River View Right"})[e]||e;function m(e){return JSON.parse(e).g?JSON.parse(e).g:"-"}function R(e){return JSON.parse(e).d?JSON.parse(e).d:"-"}function N(e){try{const t=JSON.parse(e);if(!t.l&&!t.c)return"-";const a={h:"Хвоя",c:"Цитрус",t:"Трави"},i={},g=(h,f,x=!1)=>{h&&h.split("|").forEach(D=>{const[M,E,S]=D.split(":");if(i[M]||(i[M]={sauna:null,bath:null,fills:[]}),f==="Лазня"&&(i[M].sauna=E),f==="Чан"&&(i[M].bath=E,S)){const z=(S.includes(",")?S.split(","):S.split("")).map(O=>a[O.trim()]||O.trim());i[M].fills.push(...z)}})};g(t.l.l,"Лазня"),g(t.l.c,"Чан");const c=[];return Object.keys(i).sort().forEach(h=>{const f=i[h];if(c.push(`<b>${h}</b>`),f.sauna&&c.push(`Лазня на ${f.sauna} год`),f.bath&&c.push(`Чан на ${f.bath} год`),f.fills.length){const x=[...new Set(f.fills)];c.push(`Наповнення: ${x.join(", ")}`)}}),c.join("<br>")}catch{return"-"}}const W=tt(()=>l.value.map(e=>{const t=b(e.guest),{start:a,end:i}=d(e.date);return!a||!i?(console.warn("Invalid date format for booking:",e),null):{id:e.$id,title:`${t}`,start:a,end:i,backgroundColor:u(e.house),borderColor:u(e.house),extendedProps:{booking:e,guestName:t,type:e.type,house:e.house}}}).filter(e=>e!==null)),T=e=>{o.value=e.event.extendedProps.booking},P=e=>{U.push({name:"CreateBooking",query:{date:e.dateStr}})},$=e=>{U.push({name:"CreateBooking",query:{start:e.startStr,end:e.endStr}})},j=e=>{const t=new Date(e),a=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getFullYear()).slice(-2),c=String(t.getHours()).padStart(2,"0"),h=String(t.getMinutes()).padStart(2,"0");return`${a}.${i}.${g}T${c}:${h}`},Q=async e=>{const t=e.event.extendedProps.booking,{start:a}=d(t.date),i=j(e.event.end),g=`${j(a)}-${i}`;try{await H.bookings.update(t.$id,{date:g}),F.success("Тривалість бронювання оновлено");const c=l.value.findIndex(h=>h.$id===t.$id);c!==-1&&(l.value[c].date=g)}catch(c){console.error("Error updating booking:",c),F.error("Помилка при оновленні тривалості"),e.revert()}},L=()=>{o.value=null},K=_({plugins:[xt,Dt,Ft],initialView:"timeGridWeek",locale:St,headerToolbar:{left:"prev,next today",center:"title",right:"multiMonthYear,dayGridMonth,timeGridWeek,timeGridDay"},buttonText:{today:"Сьогодні",month:"Місяць",week:"Тиждень",day:"День",multiMonthYear:"Рік"},slotMinTime:"06:00:00",slotMaxTime:"24:00:00",allDaySlot:!1,events:W,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,height:"auto",eventClick:T,dateClick:P,select:$,eventResize:Q});return et(async()=>{nt({title:"Календар"});try{const e=await H.bookings.list();l.value=e.bookings;const t=await H.guests.list();n.value=t.guests}catch(e){console.error("Error loading data:",e),F.error("Помилка при завантаженні даних")}}),(e,t)=>{const a=ot("router-link");return A(),st(dt,null,{default:q(()=>[t[14]||(t[14]=s("p",{class:"comment"},"Календар",-1)),s("div",Vt,[I(at(Rt),{options:K.value},null,8,["options"])]),o.value?(A(),lt("div",{key:0,class:"modal-overlay",onClick:L},[s("div",{class:"modal-content",onClick:t[1]||(t[1]=rt(()=>{},["stop"]))},[s("div",Bt,[s("div",jt,[t[2]||(t[2]=s("h3",null,"Бронювання",-1)),s("small",null,"#"+C(o.value.$id),1)]),s("button",{class:"close-btn",onClick:L},t[3]||(t[3]=[s("span",null," × ",-1)]))]),s("div",Lt,[s("div",Yt,[t[4]||(t[4]=s("span",{class:"label"},"Гість:",-1)),s("span",qt,[I(a,{to:`/guests/${o.value.guest}`},{default:q(()=>[ct(C(b(o.value.guest)),1)]),_:1},8,["to"])])]),s("div",At,[t[5]||(t[5]=s("span",{class:"label"},"Тип:",-1)),s("span",It,C(y(o.value.type)),1)]),s("div",Ut,[t[6]||(t[6]=s("span",{class:"label"},"Будинок:",-1)),s("span",Gt,C(v(o.value.house)),1)]),s("div",Jt,[t[7]||(t[7]=s("span",{class:"label"},"К-сть гостей:",-1)),s("span",Zt,C(m(o.value.meta)),1)]),s("div",Qt,[t[8]||(t[8]=s("span",{class:"label"},"Дата та час:",-1)),s("span",Kt,C(r(o.value.date)),1)]),s("div",Xt,[t[11]||(t[11]=s("span",{class:"label"},"Договір:",-1)),s("span",te,[s("button",{onClick:t[0]||(t[0]=i=>w(o.value.guest,o.value.$id))},t[9]||(t[9]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",class:"injected-svg","data-src":"https://cdn.hugeicons.com/icons/qr-code-stroke-rounded.svg?v=3.0","xmlns:xlink":"http://www.w3.org/1999/xlink",role:"img",color:"#ffffff"},[s("path",{d:"M3 6C3 4.58579 3 3.87868 3.43934 3.43934C3.87868 3 4.58579 3 6 3C7.41421 3 8.12132 3 8.56066 3.43934C9 3.87868 9 4.58579 9 6C9 7.41421 9 8.12132 8.56066 8.56066C8.12132 9 7.41421 9 6 9C4.58579 9 3.87868 9 3.43934 8.56066C3 8.12132 3 7.41421 3 6Z",stroke:"#ffffff","stroke-width":"1.5"}),s("path",{d:"M3 18C3 16.5858 3 15.8787 3.43934 15.4393C3.87868 15 4.58579 15 6 15C7.41421 15 8.12132 15 8.56066 15.4393C9 15.8787 9 16.5858 9 18C9 19.4142 9 20.1213 8.56066 20.5607C8.12132 21 7.41421 21 6 21C4.58579 21 3.87868 21 3.43934 20.5607C3 20.1213 3 19.4142 3 18Z",stroke:"#ffffff","stroke-width":"1.5"}),s("path",{d:"M3 12L9 12",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M12 3V8",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M15 6C15 4.58579 15 3.87868 15.4393 3.43934C15.8787 3 16.5858 3 18 3C19.4142 3 20.1213 3 20.5607 3.43934C21 3.87868 21 4.58579 21 6C21 7.41421 21 8.12132 20.5607 8.56066C20.1213 9 19.4142 9 18 9C16.5858 9 15.8787 9 15.4393 8.56066C15 8.12132 15 7.41421 15 6Z",stroke:"#ffffff","stroke-width":"1.5"}),s("path",{d:"M21 12H15C13.5858 12 12.8787 12 12.4393 12.4393C12 12.8787 12 13.5858 12 15M12 17.7692V20.5385M15 15V16.5C15 17.9464 15.7837 18 17 18C17.5523 18 18 18.4477 18 19M16 21H15M18 15C19.4142 15 20.1213 15 20.5607 15.44C21 15.8799 21 16.5881 21 18.0043C21 19.4206 21 20.1287 20.5607 20.5687C20.24 20.8898 19.7767 20.9766 19 21",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round"})],-1)])),t[10]||(t[10]=s("button",null,[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",class:"injected-svg","data-src":"https://cdn.hugeicons.com/icons/link-02-stroke-rounded.svg?v=3.0","xmlns:xlink":"http://www.w3.org/1999/xlink",role:"img",color:"#ffffff"},[s("path",{d:"M9.5 14.5L14.5 9.49995",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round"}),s("path",{d:"M16.8463 14.6095L19.4558 12C21.5147 9.94108 21.5147 6.60298 19.4558 4.54411C17.397 2.48524 14.0589 2.48524 12 4.54411L9.39045 7.15366M14.6095 16.8463L12 19.4558C9.94113 21.5147 6.60303 21.5147 4.54416 19.4558C2.48528 17.3969 2.48528 14.0588 4.54416 12L7.1537 9.39041",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round"})])],-1))])]),s("div",ee,[t[12]||(t[12]=s("span",{class:"label"},"Коментар",-1)),s("span",ne,C(R(o.value.meta)),1)]),s("div",se,[t[13]||(t[13]=s("span",{class:"label"},"Лазня / чан",-1)),s("span",{class:"value",innerHTML:N(o.value.meta)},null,8,oe)])])])])):it("",!0)]),_:1})}}},me=Tt(le,[["__scopeId","data-v-e2bcca9f"]]);export{me as default};
