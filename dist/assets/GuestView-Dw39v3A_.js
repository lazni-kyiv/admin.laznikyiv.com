import{A as ve}from"./AdminView-DgyvBQoU.js";import{q as J,B as ne,a as L,s as K,c as r,o as a,b as e,d as j,t as h,w as G,C as I,D as R,F as D,E as U,n as E,l as z,g as Q,i as N,e as H,u as Y,H as ge,k as le,I as fe,f as be,z as he,j as ye}from"./index-DfC6sHtH.js";/* empty css                  */import{t as X}from"./toastr-CY63SwY8.js";/* empty css                   */import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                 */import{D as ke}from"./DogovirActions-dr_83eGJ.js";import"./Icon-CMnBudPe.js";import"./_commonjsHelpers-CqkleIqs.js";const $e={class:"guest-info__item guest-card"},we={class:"guest-card__actions"},_e={key:0,onclick:"edit.showModal()",class:"guest-edit-button"},Ce={class:"guest-card__header"},xe=["src"],Ve=["src"],Se=["src"],Be={class:"col"},je={class:"guest-name"},Oe={class:"guest-id"},Me={class:"guest_pi-list"},Le={class:"pi-item"},De={class:"pi-item"},Ue={class:"pi-item"},Ee={class:"pi-item"},Ne={key:0,class:"guest-socials"},Ae={class:"guest-socials__grid"},Te={key:0,class:"socials-item"},qe=["href"],ze={key:1,class:"socials-item"},Je=["href"],He={id:"edit",class:"modal"},Fe={class:"form-input"},Ge={class:"form-input"},Pe={style:{width:"100%","text-align":"end"}},Ze={class:"form-input"},Ie={class:"form-input"},Re={class:"form-input"},Ke={class:"select-input"},Ye=["onClick"],We={class:"modal-action"},Qe={id:"history",class:"modal"},Xe={class:"modal-box"},et={class:"guest-history"},tt={class:"history-item"},st={class:"history-item__body"},ot={class:"history-item__footer"},nt={class:"modal-action"},lt={__name:"GuestInfo",props:{guest:{type:Object},auth:{type:String,default:null}},emits:["update"],setup(l,{emit:v}){const{user:u}=ne(),o=J(()=>{var d;return(d=u.value)!=null&&d.teams?u.value.teams.some(n=>{var _;try{const c=typeof n.prefs=="string"?JSON.parse(n.prefs):n.prefs;return(_=c==null?void 0:c.guests)==null?void 0:_.includes("update")}catch{return!1}}):!1}),p=J(()=>{var d;return(d=u.value)!=null&&d.teams?u.value.teams.some(n=>{try{const _=typeof n.prefs=="string"?JSON.parse(n.prefs):n.prefs;return(_==null?void 0:_.dev)=="true"}catch{return!1}}):!1}),s=l,t=L({});K(()=>s.guest,d=>{t.value={...d}},{immediate:!0});const w=v;function V(){Q.guests.update(s.guest.$id,{alias:t.value.alias,description:t.value.description,ig:t.value.ig,tg:t.value.tg,source:t.value.source}).then(d=>{console.log(d),X.success("Гостя оновлено"),w("update",d.guest),t.value=d.guest,document.getElementById("edit").close()})}function B(d){if(!d)return"";const n=new Date(d),_=String(n.getDate()).padStart(2,"0"),c=String(n.getMonth()+1).padStart(2,"0"),y=String(n.getFullYear()).slice(2),S=String(n.getHours()).padStart(2,"0"),M=String(n.getMinutes()).padStart(2,"0"),T=String(n.getSeconds()).padStart(2,"0");return`${_}.${c}.${y} ${S}:${M}:${T}`}const C=L([]);function b(){fetch("https://api.laznikyiv.com/v2/logs/guests",{credentials:"include"}).then(d=>d.json().then(n=>{n=n.content;const _=n.split(`
`).map(y=>y.replace(/,$/,"")).filter(y=>y.length>0);console.log(_);const c=JSON.parse(`[${_.join(",")}]`).reverse();C.value=c.filter(y=>y.guest_id==s.guest.$id),document.getElementById("history").showModal()}))}function f(){document.getElementById("history").close()}const $=L([{label:"Instagram",value:"i"},{label:"Telegram",value:"tg"},{label:"Viber",value:"v"},{label:"WhatsApp",value:"w"},{label:"Телефон",value:"t"}]);return(d,n)=>{var _,c,y,S,M,T,F,i,g,m,O,q,k,A,P,Z,oe;return a(),r("div",$e,[e("div",we,[o.value?(a(),r("button",_e,n[8]||(n[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",class:"injected-svg","data-src":"https://cdn.hugeicons.com/icons/edit-03-solid-rounded.svg?v=2.0","xmlns:xlink":"http://www.w3.org/1999/xlink",role:"img"},[e("path",{d:"M18.799 3.0499C17.7324 1.98335 16.0032 1.98337 14.9366 3.04994L13.5236 4.46296L19.537 10.4763L20.9501 9.06321C22.0167 7.99665 22.0166 6.26746 20.9501 5.20092L18.799 3.0499Z",fill:"white"}),e("path",{d:"M18.4764 11.537L12.463 5.52363L4.35808 13.6286C3.66361 14.3231 3.20349 15.2172 3.04202 16.1859L2.26021 20.8767C2.22039 21.1156 2.29841 21.3591 2.46968 21.5303C2.64095 21.7016 2.88439 21.7796 3.12331 21.7398L7.81417 20.958C8.78294 20.7965 9.67706 20.3364 10.3715 19.642L18.4764 11.537Z",fill:"white"})],-1)]))):j("",!0),p.value?(a(),r("button",{key:1,onClick:n[0]||(n[0]=x=>b())},n[9]||(n[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",class:"injected-svg","data-src":"https://cdn.hugeicons.com/icons/clock-02-stroke-rounded.svg?v=1.0.1","xmlns:xlink":"http://www.w3.org/1999/xlink",role:"img",color:"#ffffff"},[e("path",{d:"M5.04798 8.60657L2.53784 8.45376C4.33712 3.70477 9.503 0.999914 14.5396 2.34474C19.904 3.77711 23.0904 9.26107 21.6565 14.5935C20.2227 19.926 14.7116 23.0876 9.3472 21.6553C5.36419 20.5917 2.58192 17.2946 2 13.4844",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8V12L14 14",stroke:"#ffffff","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):j("",!0)]),e("div",Ce,[((_=s.guest)==null?void 0:_.b)==="t"?(a(),r("img",{key:0,class:"guest-card__header__avatar",src:`https://ui-avatars.com/api/?name=${s.guest.alias}/&background=ccc&color=grey`},null,8,xe)):((c=s.guest)==null?void 0:c.b)==="p"?(a(),r("img",{key:1,class:"guest-card__header__avatar",src:`https://ui-avatars.com/api/?name=${(y=s.guest)==null?void 0:y.alias}/&background=E1B33F75&color=daa520`},null,8,Ve)):(a(),r("img",{key:2,class:"guest-card__header__avatar",src:`https://ui-avatars.com/api/?name=${(S=s.guest)==null?void 0:S.alias}/&background=3D90864A&color=1d464`},null,8,Se)),e("div",Be,[e("h4",je,h((M=s.guest)==null?void 0:M.alias),1),e("span",Oe,h((T=s.guest)==null?void 0:T.$id),1)])]),e("div",Me,[e("div",Le,[n[10]||(n[10]=e("span",null,"Дата створення",-1)),e("p",null,h(B((F=s.guest)==null?void 0:F.$createdAt)),1)]),e("div",De,[n[11]||(n[11]=e("span",null,"Востаннє оновлено",-1)),e("p",null,h(B((i=s.guest)==null?void 0:i.$updatedAt)),1)]),e("div",Ue,[n[12]||(n[12]=e("span",null,"Коментар",-1)),e("p",null,h((g=s.guest)!=null&&g.description?(m=s.guest)==null?void 0:m.description:"-"),1)]),e("div",Ee,[n[13]||(n[13]=e("span",null,"Джерело",-1)),e("p",null,h(((O=$.value.filter(x=>{var ee;return x.value==((ee=s.guest)==null?void 0:ee.source)})[0])==null?void 0:O.label)||"-"),1)]),(q=s.guest)!=null&&q.ig&&s.guest.ig!=="None"||(k=s.guest)!=null&&k.tg&&s.guest.tg!=="None"?(a(),r("div",Ne,[n[16]||(n[16]=e("hr",null,null,-1)),e("div",Ae,[s.guest.ig!=="None"&&s.guest.ig!==null?(a(),r("div",Te,[n[14]||(n[14]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",class:"injected-svg","data-src":"https://cdn.hugeicons.com/icons/instagram-stroke-rounded.svg?v=3.0","xmlns:xlink":"http://www.w3.org/1999/xlink",role:"img",color:"#000000"},[e("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"#000000","stroke-width":"1.5","stroke-linejoin":"round"}),e("path",{d:"M16.5 12C16.5 14.4853 14.4853 16.5 12 16.5C9.51472 16.5 7.5 14.4853 7.5 12C7.5 9.51472 9.51472 7.5 12 7.5C14.4853 7.5 16.5 9.51472 16.5 12Z",stroke:"#000000","stroke-width":"1.5"}),e("path",{d:"M17.5078 6.5L17.4988 6.5",stroke:"#000000","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("a",{href:`https://instagram.com/${(A=s.guest)==null?void 0:A.ig}`,target:"_blank"},h(s.guest.ig),9,qe)])):j("",!0),s.guest.tg!=="None"&&s.guest.tg!==null?(a(),r("div",ze,[n[15]||(n[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",class:"injected-svg","data-src":"https://cdn.hugeicons.com/icons/telegram-stroke-rounded.svg?v=3.0","xmlns:xlink":"http://www.w3.org/1999/xlink",role:"img",color:"#000000"},[e("path",{d:"M11.9854 15.4083L15.2268 19.0936C16.4277 20.4589 17.0282 21.1416 17.6567 20.9754C18.2852 20.8092 18.5008 19.9108 18.9318 18.1138L21.3229 8.1459C21.9868 5.37832 22.3187 3.99454 21.5808 3.312C20.843 2.62947 19.564 3.13725 17.0061 4.15282L5.13876 8.86449C3.09293 9.67674 2.07001 10.0829 2.00507 10.7808C1.99842 10.8522 1.99831 10.9241 2.00474 10.9955C2.06754 11.6937 3.08921 12.1033 5.13255 12.9223C6.05838 13.2934 6.5213 13.479 6.8532 13.8344C6.89052 13.8743 6.9264 13.9157 6.96078 13.9584C7.26658 14.3384 7.39709 14.8371 7.65808 15.8344L8.14653 17.701C8.4005 18.6715 8.52749 19.1568 8.86008 19.223C9.19267 19.2891 9.48225 18.8867 10.0614 18.0819L11.9854 15.4083ZM11.9854 15.4083L11.6676 15.0771C11.3059 14.7001 11.1251 14.5117 11.1251 14.2775C11.1251 14.0433 11.3059 13.8548 11.6676 13.4778L15.2406 9.75409",stroke:"#000000","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("a",{href:`https://t.me/${(P=s.guest)==null?void 0:P.tg}`,target:"_blank"},h(s.guest.tg),9,Je)])):j("",!0)])])):j("",!0)]),e("dialog",He,[s.guest?(a(),r("form",{key:0,class:"modal-box",onSubmit:n[6]||(n[6]=G(x=>V(),["prevent"]))},[n[23]||(n[23]=e("h3",{class:"text-lg font-bold"},"Редагувати",-1)),e("div",Fe,[n[17]||(n[17]=e("label",{for:""},"Ім'я",-1)),I(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=x=>t.value.alias=x),minlength:"1",required:""},null,512),[[R,t.value.alias]])]),e("div",Ge,[n[18]||(n[18]=e("label",{for:""},"Коментар",-1)),I(e("textarea",{style:{height:"8rem"},type:"text",maxlength:"100","onUpdate:modelValue":n[2]||(n[2]=x=>t.value.description=x),minlength:"1"},null,512),[[R,t.value.description]]),e("div",Pe,[e("small",null,h((oe=(Z=t.value)==null?void 0:Z.description)==null?void 0:oe.length)+"/100",1)])]),e("div",Ze,[n[19]||(n[19]=e("label",{for:""},"Telegram",-1)),I(e("input",{type:"text",placeholder:"@laznikyiv","onUpdate:modelValue":n[3]||(n[3]=x=>t.value.tg=x),minlength:"1"},null,512),[[R,t.value.tg]])]),e("div",Ie,[n[20]||(n[20]=e("label",{for:""},"Instagram",-1)),I(e("input",{type:"text",placeholder:"@laznikyiv","onUpdate:modelValue":n[4]||(n[4]=x=>t.value.ig=x),minlength:"1"},null,512),[[R,t.value.ig]])]),e("div",Re,[n[21]||(n[21]=e("label",{class:"mt-4"},"Джерело",-1)),e("div",Ke,[(a(!0),r(D,null,U($.value,x=>(a(),r("button",{key:x.value,type:"button",class:E(["house",{selected:t.value.source===x.value}]),onClick:ee=>t.value.source=x.value},h(x.label),11,Ye))),128))])]),e("div",We,[e("button",{class:"secondary",onClick:n[5]||(n[5]=G(()=>{},["prevent"])),onclick:"edit.close()"},"Скасувати"),n[22]||(n[22]=e("button",{type:"submit"},"Зберегти",-1))])],32)):j("",!0)]),e("dialog",Qe,[e("form",Xe,[n[30]||(n[30]=e("h3",{style:{"margin-bottom":"1rem"}},"Історія змін",-1)),e("div",et,[(a(!0),r(D,null,U(C.value,x=>(a(),r("div",tt,[e("div",{class:E(`history-item__header ${x.event}`)},[e("span",null,h(x.event),1),e("p",null,h(B(x.timestamp)),1)],2),e("div",st,[e("span",null,[n[24]||(n[24]=z(" Ім'я : ")),e("b",null,h(x.extra.after.alias),1)]),e("span",null,[n[25]||(n[25]=z(" Коментар : ")),e("b",null,h(x.extra.after.description),1)]),e("span",null,[n[26]||(n[26]=z(" ПІБ : ")),e("b",null,h(x.extra.after.name),1)]),e("span",null,[n[27]||(n[27]=z(" Дата народження : ")),e("b",null,h(x.extra.after.birthday),1)]),e("span",null,[n[28]||(n[28]=z(" Номер телефону : ")),e("b",null,h(x.extra.after.phone),1)]),e("span",null,[n[29]||(n[29]=z(" Документ : ")),e("b",null,h(x.extra.after.document),1)])]),e("div",ot,h(x.email),1)]))),256))]),e("div",nt,[e("button",{class:"secondary",onClick:n[7]||(n[7]=G(x=>f(),["prevent"]))},"Закрити")])])])])}}},it=te(lt,[["__scopeId","data-v-dda87ade"]]),at={class:"guest-info__item guest-card"},ut=["disabled"],dt={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},rt=["fill"],ct=["fill"],pt={key:1,class:"guest_pi-list"},mt={class:"pi-item"},vt={class:"pi-item"},gt={class:"pi-item"},ft={class:"pi-item"},bt={key:2,class:"guest_pi-list no-data"},ht={__name:"GuestPersonalInfo",props:{guest:Object,auth:String},setup(l){const v=l,u=L({...v.guest});L("");const o=L(null);return K(()=>v.guest,p=>{u.value={...p}}),(p,s)=>{var t,w,V,B;return a(),r("div",at,[["dev"].includes(v.auth)?(a(),r("button",{key:0,disabled:p.placeholder,onClick:s[0]||(s[0]=C=>o.value.showModal()),class:"guest-edit-button"},[(a(),r("svg",dt,[e("path",{d:"M18.799 3.0499C17.7324 1.98335 16.0032 1.98337 14.9366 3.04994L13.5236 4.46296L19.537 10.4763L20.9501 9.06321C22.0167 7.99665 22.0166 6.26746 20.9501 5.20092L18.799 3.0499Z",fill:p.placeholder?"grey":"white"},null,8,rt),e("path",{d:"M18.4764 11.537L12.463 5.52363L4.35808 13.6286C3.66361 14.3231 3.20349 15.2172 3.04202 16.1859L2.26021 20.8767C2.22039 21.1156 2.29841 21.3591 2.46968 21.5303C2.64095 21.7016 2.88439 21.7796 3.12331 21.7398L7.81417 20.958C8.78294 20.7965 9.67706 20.3364 10.3715 19.642L18.4764 11.537Z",fill:p.placeholder?"grey":"white"},null,8,ct)]))],8,ut)):j("",!0),s[6]||(s[6]=e("h3",null,"Особиста інформація",-1)),v.guest&&(v.guest.name||v.guest.birthday||v.guest.phone||v.guest.document)?(a(),r("div",pt,[e("div",mt,[s[1]||(s[1]=e("span",null,"ПІБ",-1)),e("p",null,h(((t=v.guest)==null?void 0:t.name)||"-"),1)]),e("div",vt,[s[2]||(s[2]=e("span",null,"Дата народження",-1)),e("p",null,h(((w=v.guest)==null?void 0:w.birthday)||"-"),1)]),e("div",gt,[s[3]||(s[3]=e("span",null,"Номер телефону",-1)),e("p",null,h(((V=v.guest)==null?void 0:V.phone)||"-"),1)]),e("div",ft,[s[4]||(s[4]=e("span",null,"Паспортні дані",-1)),e("p",null,h(((B=v.guest)==null?void 0:B.document)||"-"),1)])])):(a(),r("div",bt,s[5]||(s[5]=[e("i",{class:"hgi-stroke hgi-document-attachment"},null,-1),e("p",null,"Гість ще не підписав жодного договору",-1)])))])}}},yt=te(ht,[["__scopeId","data-v-979060fa"]]),kt={class:"bookings-list no-bookings"},$t={key:0,onclick:"newBooking.showModal()"},wt={__name:"EmptyBookingsState",props:{canAddBookings:Boolean},setup(l){return(v,u)=>(a(),r("div",kt,[u[0]||(u[0]=e("i",{class:"hgi-stroke hgi-calendar-02"},null,-1)),u[1]||(u[1]=e("p",null,"У цього гостя ще немає бронювань",-1)),l.canAddBookings?(a(),r("button",$t," Додати бронювання ")):j("",!0)]))}},_t={class:"booking-card"},Ct={class:"booking-card__header"},xt={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},Vt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},St={key:2,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},Bt={class:"booking-actions"},jt={key:0},Ot={style:{"margin-top":"0.5rem",display:"flex",gap:"0.25rem"}},Mt={__name:"BookingCard",props:{booking:Object,guest:Object,canUpdateBookings:Boolean},emits:["edit","update:guest"],setup(l,{emit:v}){const u=v;function o(p){const[[s,t],[w,V]]=p.split("-").map(B=>B.split("T"));return`${s} ${t} - ${w} ${V}`}return(p,s)=>(a(),r("div",_t,[e("div",Ct,[e("div",{class:E(["booking-badge",l.booking.house])},[l.booking.type==="house"?(a(),r("svg",xt,s[2]||(s[2]=[e("path",{d:"M3 9.98834V19.5C3 20.6046 3.89543 21.5 5 21.5H19C20.1046 21.5 21 20.6046 21 19.5V9.98834C21 9.3654 20.7097 8.77803 20.2149 8.39963L12.8972 2.80373C12.6396 2.60673 12.3243 2.5 12 2.5C11.6757 2.5 11.3604 2.60673 11.1028 2.80373L3.7851 8.39963C3.29026 8.77804 3 9.3654 3 9.98834Z",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M17 17.5001V13.5001",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):l.booking.type==="pool"?(a(),r("svg",Vt,s[3]||(s[3]=[e("path",{d:"M22 21H21C19.5486 21 18.278 20.1411 18 19C17.722 20.1411 16.4514 21 15 21C13.5486 21 12.278 20.1411 12 19C11.722 20.1411 10.4514 21 9 21C7.54863 21 6.27796 20.1411 6 19C5.72204 20.1411 4.45137 21 3 21H2",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M19 3L18.7351 3.0883C17.4151 3.52832 16.755 3.74832 16.3775 4.2721C16 4.79587 16 5.49159 16 6.88304L16 17",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M11 3L10.7351 3.0883C9.41505 3.52832 8.75503 3.74832 8.37752 4.2721C8 4.79587 8 5.49159 8 6.88304L8 17",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M8 7H16M8 11H16M8 15H16",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):l.booking.type==="lazni"?(a(),r("svg",St,s[4]||(s[4]=[e("path",{d:"M9.10448 17.5C8.33359 16.5723 8.42384 15.1986 8.69771 14.3155C13.1751 16.5 13.7595 12.5 13.4229 11.5C14.9282 12.5 16.3877 15.9189 14.8371 17.5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M8.81631 17.5C5.5924 16.4286 4.76862 11.5478 6.12929 8.92857C7.12501 11.0714 8.75001 11.0714 8.75001 11.0714C7.66668 6.78571 9.83335 3.57143 14.0108 2.5C13.1918 4.001 12.5366 6.34631 14.197 7.84902C14.5485 7.18039 15.7296 5.71429 17.4167 5.71429C17.4167 5.71429 16.1196 8.01619 17.5273 10.0221C19.152 12.3372 18.736 15.7851 16.3196 17.5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M20.5 17.5H3.5L4.1601 19.9851C4.4949 21.2455 4.84122 21.5 6.22165 21.5H17.7783C19.1588 21.5 19.5051 21.2455 19.8399 19.9851L20.5 17.5Z",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M3.55556 17.5H2.5M20.4444 17.5H21.5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):j("",!0)],2),e("p",null,h(o(l.booking.date)),1)]),e("mark",null,h(l.booking.$id),1),s[8]||(s[8]=e("br",null,null,-1)),e("div",Bt,[e("div",null,[s[5]||(s[5]=e("p",null,"Договір",-1)),N(ke,{guest:l.guest,booking:l.booking,"onUpdate:guest":s[0]||(s[0]=t=>u("update:guest",t))},null,8,["guest","booking"])]),l.canUpdateBookings?(a(),r("div",jt,[s[7]||(s[7]=e("p",null,"Дії",-1)),e("div",Ot,[e("button",{class:"icon-btn",onClick:s[1]||(s[1]=t=>u("edit")),title:"Редагувати бронювання"},s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M18.799 3.0499C17.7324 1.98335 16.0032 1.98337 14.9366 3.04994L13.5236 4.46296L19.537 10.4763L20.9501 9.06321C22.0167 7.99665 22.0166 6.26746 20.9501 5.20092L18.799 3.0499Z",fill:"white"}),e("path",{d:"M18.4764 11.537L12.463 5.52363L4.35808 13.6286C3.66361 14.3231 3.20349 15.2172 3.04202 16.1859L2.26021 20.8767C2.22039 21.1156 2.29841 21.3591 2.46968 21.5303C2.64095 21.7016 2.88439 21.7796 3.12331 21.7398L7.81417 20.958C8.78294 20.7965 9.67706 20.3364 10.3715 19.642L18.4764 11.537Z",fill:"white"})],-1)]))])])):j("",!0)])]))}},Lt={class:"bookings-list"},Dt={__name:"BookingsList",props:{bookings:Array,guest:Object,canUpdateBookings:Boolean},emits:["edit","update:guest"],setup(l,{emit:v}){const u=v;return(o,p)=>(a(),r("div",Lt,[(a(!0),r(D,null,U(l.bookings,s=>(a(),H(Mt,{key:s.$id,booking:s,guest:l.guest,canUpdateBookings:l.canUpdateBookings,onEdit:t=>u("edit",s),"onUpdate:guest":p[0]||(p[0]=t=>u("update:guest",t))},null,8,["booking","guest","canUpdateBookings","onEdit"]))),128))]))}},Ut=[{value:"house",label:"Будинку"},{value:"lazni",label:"Лазні / чану"},{value:"pool",label:"Басейну"}],Et=[{value:"family",label:"Family House"},{value:"right",label:"RV Right"},{value:"left",label:"RV Left"}],Nt=[{value:"h",label:"Хвоя"},{value:"c",label:"Цитрус"},{value:"t",label:"Трави"}],At=[{label:"Instagram",value:"i"},{label:"Telegram",value:"tg"},{label:"Viber",value:"v"},{label:"WhatsApp",value:"w"},{label:"Телефон",value:"t"},{label:"Бот",value:"b"}];function Tt(){const l=[];for(let o=360;o<=1440;o+=30){const p=String(Math.floor(o/60)).padStart(2,"0"),s=String(o%60).padStart(2,"0");l.push(p==="24"?`00:${s}`:`${p}:${s}`)}return l}function qt(l){const v=l.getDate().toString().padStart(2,"0"),u=(l.getMonth()+1).toString().padStart(2,"0"),o=l.getFullYear().toString().slice(-2);return`${v}.${u}.${o}`}function W(l,v){const u=new Date(l),o=String(u.getFullYear()).slice(-2),p=String(u.getMonth()+1).padStart(2,"0");return`${String(u.getDate()).padStart(2,"0")}.${p}.${o}T${v}`}function se(l,v,u){const o=new Date(l),p=u==="house"?new Date(new Date(v).setDate(new Date(v).getDate()-1)):new Date(l),s=[],t=new Date(o);for(;t<=p;)s.push({date:new Date(t),l:{booked:!1,t:2},c:{booked:!1,t:2,f:[]}}),t.setDate(t.getDate()+1);return s}function ie(l){const v=[],u=[];return l.forEach(o=>{const p=qt(o.date);if(o.l.booked&&o.l.t>0&&v.push(`${p}:${o.l.t}`),o.c.booked&&o.c.t>0){const s=o.c.f.length?o.c.f.join(","):null;u.push(`${p}:${o.c.t}:${s}`)}}),{lazni:v.join("|"),chan:u.join("|")}}function ae(l,v,u,o,p){return p==="pool"||p==="lazni"?`${W(l,v)}-${W(l,o)}`:`${W(l,v)}-${W(u,o)}`}function zt(l,v){if(!l)return{in:{date:null,time:null},out:{date:null,time:null}};const u=l.includes(" - ")?l.split(" - "):l.split("-");let[o,p]=u[0].trim().split("T");o=`20${o.split(".")[2]}-${o.split(".")[1]}-${o.split(".")[0]}`;let s=null,t=null;if(u[1]){const w=u[1].trim();w.includes("T")?([s,t]=w.split("T"),s=`20${s.split(".")[2]}-${s.split(".")[1]}-${s.split(".")[0]}`):(s=o,t=w)}return{in:{date:o,time:p},out:{date:s,time:t}}}function Jt(l,v,u,o){const p=se(l,v,o);return u&&(u.l&&Array.isArray(u.l)&&u.l.forEach((s,t)=>{p[t]&&(p[t].lazni=s===1)}),u.c&&Array.isArray(u.c)&&u.c.forEach((s,t)=>{p[t]&&(p[t].chan=s===1)})),p}const Ht={class:"form-input"},Ft={class:"select-input"},Gt=["onClick"],ue={__name:"BookingTypeSelector",props:{modelValue:String},emits:["update:modelValue"],setup(l){return(v,u)=>(a(),r("div",Ht,[u[0]||(u[0]=e("label",null,"Оренда",-1)),e("div",Ft,[(a(!0),r(D,null,U(Y(Ut),o=>(a(),r("button",{key:o.value,type:"button",class:E(["house",{selected:l.modelValue===o.value}]),onClick:p=>v.$emit("update:modelValue",o.value)},h(o.label),11,Gt))),128))])]))}},Pt={class:"select-input"},Zt=["disabled","onClick"],de={__name:"HouseSelector",props:{modelValue:String,type:String},emits:["update:modelValue"],setup(l){return(v,u)=>(a(),r("div",{class:E(["form-input",{blured:!l.type}])},[u[0]||(u[0]=e("label",null,"Будинок",-1)),e("div",Pt,[(a(!0),r(D,null,U(Y(Et),o=>(a(),r("button",{key:o.value,type:"button",disabled:o.value!=="family"&&l.type==="pool",class:E(["house",{selected:l.modelValue===o.value}]),onClick:p=>v.$emit("update:modelValue",o.value)},h(o.label),11,Zt))),128))])],2))}},It={class:"input-row"},Rt=["disabled"],Kt=["value"],re={__name:"GuestsCounter",props:{modelValue:{type:Number,default:0},disabled:Boolean},emits:["update:modelValue"],setup(l,{emit:v}){const u=l,o=v;function p(){o("update:modelValue",(u.modelValue||0)+1)}function s(){u.modelValue>1&&o("update:modelValue",u.modelValue-1)}return(t,w)=>(a(),r("div",{class:E(["form-input",{blured:l.disabled}]),style:{"margin-bottom":"0.5rem"}},[w[0]||(w[0]=e("label",null,"Кількість осіб",-1)),e("div",It,[e("button",{type:"button",class:"component-button",onClick:s,disabled:l.modelValue<=1},"-",8,Rt),e("input",{type:"number",value:l.modelValue,readonly:""},null,8,Kt),e("button",{type:"button",class:"component-button",onClick:p},"+")])],2))}},Yt={class:"form-input form-box"},Wt=["value"],Qt=["value"],Xt=["value"],es={class:"form-input form-box"},ts=["value"],ss=["value"],os=["value"],ns=["value"],ce={__name:"DateRangePicker",props:{dateIn:Object,dateOut:Object,type:String,disabled:Boolean},emits:["update:dateIn","update:dateOut","update"],setup(l){const v=Tt();return(u,o)=>(a(),r("div",{class:E(["booking-date",{blured:l.disabled}])},[e("div",Yt,[o[7]||(o[7]=e("label",null,[e("span",null,"Заїзд")],-1)),e("input",{type:"date",required:"",value:l.dateIn.date,onInput:o[0]||(o[0]=p=>u.$emit("update:dateIn",{...l.dateIn,date:p.target.value})),onChange:o[1]||(o[1]=p=>u.$emit("update"))},null,40,Wt),e("select",{required:"",value:l.dateIn.time,onChange:o[2]||(o[2]=p=>u.$emit("update:dateIn",{...l.dateIn,time:p.target.value}))},[o[6]||(o[6]=e("option",{disabled:"",hidden:"",value:""},"--:--",-1)),(a(!0),r(D,null,U(Y(v),p=>(a(),r("option",{key:p,value:p},h(p),9,Xt))),128))],40,Qt)]),e("div",es,[o[9]||(o[9]=e("label",null,[e("span",null,"Виїзд")],-1)),l.type==="house"?(a(),r("input",{key:0,type:"date",required:"",value:l.dateOut.date,onInput:o[3]||(o[3]=p=>u.$emit("update:dateOut",{...l.dateOut,date:p.target.value})),onChange:o[4]||(o[4]=p=>u.$emit("update"))},null,40,ts)):(a(),r("input",{key:1,type:"date",value:l.dateIn.date,readonly:""},null,8,ss)),e("select",{required:"",value:l.dateOut.time,onChange:o[5]||(o[5]=p=>u.$emit("update:dateOut",{...l.dateOut,time:p.target.value}))},[o[8]||(o[8]=e("option",{disabled:"",hidden:"",value:""},"--:--",-1)),(a(!0),r(D,null,U(Y(v),p=>(a(),r("option",{key:p,value:p},h(p),9,ns))),128))],40,os)])],2))}},ls={class:"daily-options"},is={class:"option-block"},as=["onClick"],us={key:0},ds={key:0,class:"option-subblock"},rs={class:"duration mt-2"},cs={class:"form-input"},ps={class:"input-row"},ms=["onClick","disabled"],vs=["value"],gs=["onClick"],fs={class:"option-block mt-4"},bs=["onClick"],hs={key:0},ys={key:0,class:"option-subblock"},ks={class:"duration mt-2"},$s={class:"form-input",style:{"margin-bottom":"0.5rem"}},ws={class:"input-row"},_s=["onClick","disabled"],Cs=["value"],xs=["onClick"],Vs={class:"fill-options mt-3 form-input"},Ss={class:"fill-buttons mt-1"},Bs=["onClick"],js={key:0},pe={__name:"DailyOptions",props:{modelValue:{type:Array,required:!0}},emits:["update:modelValue"],setup(l,{emit:v}){const u=l,o=v;function p(C){return new Intl.DateTimeFormat("uk-UA",{day:"2-digit",month:"short",weekday:"short"}).format(C)}function s(C){const b=[...u.modelValue];b[C].l.booked=!b[C].l.booked,o("update:modelValue",b)}function t(C){const b=[...u.modelValue];b[C].c.booked=!b[C].c.booked,o("update:modelValue",b)}function w(C,b){const f=[...u.modelValue];f[C][b].t++,o("update:modelValue",f)}function V(C,b){const f=[...u.modelValue];f[C][b].t>2&&(f[C][b].t--,o("update:modelValue",f))}function B(C,b){const f=[...u.modelValue],$=f[C].c.f,d=$.indexOf(b);d>-1?$.splice(d,1):$.push(b),o("update:modelValue",f)}return(C,b)=>(a(),r("div",ls,[(a(!0),r(D,null,U(l.modelValue,(f,$)=>(a(),r("div",{key:$,class:"daily-card"},[e("h4",null,h(p(f.date)),1),e("div",is,[e("button",{type:"button",class:E([f.l.booked?"primary":"secondary","toggle-btn","sub-tab"]),onClick:d=>s($)},[f.l.booked?(a(),r("span",us,b[0]||(b[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M5 14.5C5 14.5 6.5 14.5 8.5 18C8.5 18 14.0588 8.83333 19 7",stroke:"#000000","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):j("",!0),b[1]||(b[1]=z(" Лазня "))],10,as),f.l.booked?(a(),r("div",ds,[e("div",rs,[e("div",cs,[b[2]||(b[2]=e("label",null,"Години",-1)),e("div",ps,[e("button",{class:"component-button",type:"button",onClick:d=>V($,"l"),disabled:f.l.t<=2},"-",8,ms),e("input",{type:"number",value:f.l.t,readonly:""},null,8,vs),e("button",{class:"component-button",type:"button",onClick:d=>w($,"l")},"+",8,gs)])])])])):j("",!0)]),e("div",fs,[e("button",{type:"button",class:E([f.c.booked?"primary":"secondary","toggle-btn","sub-tab"]),onClick:d=>t($)},[f.c.booked?(a(),r("span",hs,b[3]||(b[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M5 14.5C5 14.5 6.5 14.5 8.5 18C8.5 18 14.0588 8.83333 19 7",stroke:"#000000","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):j("",!0),b[4]||(b[4]=z(" Чан "))],10,bs),f.c.booked?(a(),r("div",ys,[e("div",ks,[e("div",$s,[b[5]||(b[5]=e("label",null,"Години",-1)),e("div",ws,[e("button",{class:"component-button",type:"button",onClick:d=>V($,"c"),disabled:f.c.t<=2},"-",8,_s),e("input",{type:"number",value:f.c.t,readonly:""},null,8,Cs),e("button",{class:"component-button",type:"button",onClick:d=>w($,"c")},"+",8,xs)])]),e("div",Vs,[b[7]||(b[7]=e("label",null,"Наповнення",-1)),e("div",Ss,[(a(!0),r(D,null,U(Y(Nt),d=>(a(),r("button",{key:d.value,type:"button",class:E([f.c.f.includes(d.value)?"primary":"secondary","toggle-btn"]),onClick:n=>B($,d.value)},[f.c.f.includes(d.value)?(a(),r("span",js,b[6]||(b[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M5 14.5C5 14.5 6.5 14.5 8.5 18C8.5 18 14.0588 8.83333 19 7",stroke:"#000000","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):j("",!0),z(" "+h(d.label),1)],10,Bs))),128))])])])])):j("",!0)])]))),128))]))}},Os={key:0,class:"services-section"},Ms={class:"services-list items-list space-y-4"},Ls={class:"font-medium mb-2"},Ds={key:0,class:"space-y-2"},Us={class:"flex-1"},Es={class:"input-row"},Ns=["onClick","disabled"],As=["value"],Ts=["onClick"],qs={key:1,class:"flex items-center justify-between gap-3"},zs={class:"input-row"},Js=["onClick","disabled"],Hs=["value"],Fs=["onClick"],Gs={key:1,class:"services-section mt-6"},Ps={key:0},Zs={key:1},Is={key:2,class:"items-list"},Rs={class:"flex-1"},Ks={class:"input-row"},Ys=["onClick","disabled"],Ws=["value"],Qs=["onClick"],Xs={key:2,class:"services-section"},eo={class:"items-list space-y-4"},to={class:"font-medium mb-2"},so={class:"flex items-center justify-between gap-3"},oo={class:"input-row"},no=["onClick","disabled"],lo=["value"],io=["onClick"],ao={key:3,class:"services-section mt-6"},uo={class:"items-list space-y-4"},ro={class:"font-medium mb-2"},co={class:"flex items-center justify-between gap-3"},po={class:"input-row"},mo=["onClick","disabled"],vo=["value"],go=["onClick"],fo={__name:"ServicesSelector",props:{services:{type:Object,required:!0},disabled:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update","update:modelValue"],setup(l,{expose:v,emit:u}){const o=l,p=u,s=L(null),t=ge({services:{},kram:{},author:{},comp:{}});K(()=>{var i;return(i=o.services)==null?void 0:i.services},i=>{!i||!Array.isArray(i)||i.forEach(g=>{t.services[g.id]||(g.type&&g.type.length?t.services[g.id]={types:{}}:t.services[g.id]={qty:0})})},{immediate:!0}),K(()=>o.modelValue,i=>{i&&w(i)},{immediate:!0,deep:!0});function w(i){if(!i||typeof i!="object"){console.warn("Invalid data passed to loadExistingData:",i);return}console.log("Loading existing services data:",i),t.services&&typeof t.services=="object"&&Object.keys(t.services).forEach(g=>{var m,O;(m=t.services[g])!=null&&m.types?t.services[g].types={}:((O=t.services[g])==null?void 0:O.qty)!==void 0&&(t.services[g].qty=0)}),t.kram={},t.author={},t.comp={},i.services&&typeof i.services=="object"&&Object.keys(i.services).forEach(g=>{const m=i.services[g];m&&(m.types&&typeof m.types=="object"?(t.services[g]||(t.services[g]={types:{}}),t.services[g].types||(t.services[g].types={}),t.services[g].types={...m.types}):m.qty!==void 0&&(t.services[g]||(t.services[g]={qty:0}),t.services[g].qty=m.qty))}),i.kram&&typeof i.kram=="object"&&(t.kram={...i.kram}),i.author&&typeof i.author=="object"&&(t.author={...i.author}),i.comp&&typeof i.comp=="object"&&(t.comp={...i.comp}),console.log("Loaded selectedExtras:",JSON.parse(JSON.stringify(t)))}const V=J(()=>{let i=0;return Object.values(t.services).forEach(g=>{g.types?Object.values(g.types).forEach(m=>{m>0&&i++}):g.qty>0&&i++}),Object.values(t.kram).forEach(g=>{g>0&&i++}),Object.values(t.author).forEach(g=>{g>0&&i++}),Object.values(t.comp).forEach(g=>{g>0&&i++}),i});function B(i,g){var m;return(m=t.services[i])!=null&&m.types&&t.services[i].types[g]||0}function C(i,g){t.services[i]||(t.services[i]={types:{}}),t.services[i].types||(t.services[i].types={}),t.services[i].types[g]||(t.services[i].types[g]=0),t.services[i].types[g]++}function b(i,g){var m,O;((O=(m=t.services[i])==null?void 0:m.types)==null?void 0:O[g])>0&&t.services[i].types[g]--}function f(i){t.services[i]||(t.services[i]={qty:0}),t.services[i].qty++}function $(i){var g;((g=t.services[i])==null?void 0:g.qty)>0&&t.services[i].qty--}function d(i){t.kram[i]||(t.kram[i]=0),t.kram[i]++}function n(i){t.kram[i]>0&&t.kram[i]--}function _(i){t.author[i]||(t.author[i]=0),t.author[i]++}function c(i){t.author[i]>0&&t.author[i]--}function y(i){t.comp[i]||(t.comp[i]=0),t.comp[i]++}function S(i){t.comp[i]>0&&t.comp[i]--}function M(){var i;o.disabled||(i=s.value)==null||i.showModal()}function T(){var i;(i=s.value)==null||i.close()}function F(){const i={};Object.keys(t.services).forEach(k=>{const A=t.services[k];if(A.types){const P={};Object.keys(A.types).forEach(Z=>{A.types[Z]>0&&(P[Z]=A.types[Z])}),Object.keys(P).length>0&&(i[k]={types:P})}else A.qty>0&&(i[k]={qty:A.qty})});const g={};Object.keys(t.kram).forEach(k=>{t.kram[k]>0&&(g[k]=t.kram[k])});const m={};Object.keys(t.author).forEach(k=>{t.author[k]>0&&(m[k]=t.author[k])});const O={};Object.keys(t.comp).forEach(k=>{t.comp[k]>0&&(O[k]=t.comp[k])});const q={services:i,kram:g,author:m,comp:O};p("update",q),p("update:modelValue",q),X.success("Послуги додано"),T()}return v({reset:()=>{Object.keys(t.services).forEach(i=>{t.services[i].types?t.services[i].types={}:t.services[i].qty=0}),t.kram={},t.author={},t.comp={}}}),(i,g)=>(a(),r(D,null,[e("div",{class:E(["form-input",{blured:l.disabled}])},[g[0]||(g[0]=e("label",null,"Послуги",-1)),e("button",{onClick:G(M,["prevent"])}," Додати "+h(V.value>0?`(${V.value})`:""),1)],2),e("dialog",{id:"addServices",class:"modal",ref_key:"modal",ref:s},[e("form",{class:"modal-box",onSubmit:G(F,["prevent"])},[l.services.services&&l.services.services.length?(a(),r("div",Os,[g[2]||(g[2]=e("h4",{class:"font-semibold mb-3"},"Послуги",-1)),e("div",Ms,[(a(!0),r(D,null,U(l.services.services,m=>{var O,q;return a(),r("div",{class:"service-item",key:m.id},[e("p",Ls,h(m.name),1),m.type&&m.type.length?(a(),r("div",Ds,[(a(!0),r(D,null,U(m.type,k=>(a(),r("div",{key:k.id,class:"flex items-center justify-between gap-3"},[e("span",Us,h(k.name),1),e("div",Es,[e("button",{class:"component-button",type:"button",onClick:A=>b(m.id,k.id),disabled:!B(m.id,k.id)||B(m.id,k.id)<=0}," - ",8,Ns),e("input",{type:"number",value:B(m.id,k.id)||0,readonly:"",class:"w-16 text-center"},null,8,As),e("button",{class:"component-button",type:"button",onClick:A=>C(m.id,k.id)},"+",8,Ts)])]))),128))])):(a(),r("div",qs,[g[1]||(g[1]=e("span",{class:"flex-1"},"Кількість",-1)),e("div",zs,[e("button",{class:"component-button",type:"button",onClick:k=>$(m.id),disabled:!((O=t.services[m.id])!=null&&O.qty)||t.services[m.id].qty<=0}," - ",8,Js),e("input",{type:"number",value:((q=t.services[m.id])==null?void 0:q.qty)||0,readonly:"",class:"w-16 text-center"},null,8,Hs),e("button",{class:"component-button",type:"button",onClick:k=>f(m.id)},"+",8,Fs)])]))])}),128))])])):j("",!0),l.services.kram&&Object.keys(l.services.kram).length>0?(a(),r("div",Gs,[(a(!0),r(D,null,U(l.services.kram,(m,O)=>{var q;return a(),r("div",{key:O,class:"mb-4"},[m&&m.length>0&&((q=m[0])!=null&&q.category)?(a(),r("h4",Ps,h(m[0].category),1)):(a(),r("h4",Zs,h(O),1)),m&&m.length>0?(a(),r("div",Is,[(a(!0),r(D,null,U(m,k=>(a(),r("div",{key:k.id,class:"service-item"},[e("span",Rs,h(k.name),1),e("div",Ks,[e("button",{class:"component-button",type:"button",onClick:A=>n(k.id),disabled:!t.kram[k.id]||t.kram[k.id]<=0}," - ",8,Ys),e("input",{type:"number",value:t.kram[k.id]||0,readonly:"",class:"w-16 text-center"},null,8,Ws),e("button",{class:"component-button",type:"button",onClick:A=>d(k.id)},"+",8,Qs)])]))),128))])):j("",!0)])}),128))])):j("",!0),l.services.author_specials&&l.services.author_specials.length?(a(),r("div",Xs,[g[3]||(g[3]=e("h4",{class:"font-semibold mb-3"},"Авторські спеціали",-1)),e("div",eo,[(a(!0),r(D,null,U(l.services.author_specials,m=>(a(),r("div",{class:"service-item",key:m.id},[e("p",to,h(m.name),1),e("div",so,[e("div",oo,[e("button",{class:"component-button",type:"button",onClick:O=>c(m.id),disabled:!t.author[m.id]||t.author[m.id]<=0}," - ",8,no),e("input",{type:"number",value:t.author[m.id]||0,readonly:"",class:"w-16 text-center"},null,8,lo),e("button",{class:"component-button",type:"button",onClick:O=>_(m.id)},"+",8,io)])])]))),128))])])):j("",!0),l.services.complexes&&l.services.complexes.length?(a(),r("div",ao,[g[4]||(g[4]=e("h4",{class:"font-semibold mb-3"},"Комплекси",-1)),e("div",uo,[(a(!0),r(D,null,U(l.services.complexes,m=>(a(),r("div",{class:"service-item",key:m.id},[e("p",ro,h(m.name),1),e("div",co,[e("div",po,[e("button",{class:"component-button",type:"button",onClick:O=>S(m.id),disabled:!t.comp[m.id]||t.comp[m.id]<=0}," - ",8,mo),e("input",{type:"number",value:t.comp[m.id]||0,readonly:"",class:"w-16 text-center"},null,8,vo),e("button",{class:"component-button",type:"button",onClick:O=>y(m.id)},"+",8,go)])])]))),128))])])):j("",!0),e("div",{class:"modal-action",style:{"margin-top":"1.5rem"}},[e("button",{class:"secondary",type:"button",onClick:T},"Скасувати"),g[5]||(g[5]=e("button",{type:"submit"},"Зберегти",-1))])],32)],512)],64))}},bo={class:"select-input"},ho=["onClick"],me={__name:"SourceSelector",props:{modelValue:String,disabled:Boolean},emits:["update:modelValue"],setup(l){return(v,u)=>(a(),r("div",{class:E(["form-input",{blured:l.disabled}])},[u[0]||(u[0]=e("label",{class:"mt-4"},"Джерело",-1)),e("div",bo,[(a(!0),r(D,null,U(Y(At),o=>(a(),r("button",{key:o.value,type:"button",class:E(["house",{selected:l.modelValue===o.value}]),onClick:p=>v.$emit("update:modelValue",o.value)},h(o.label),11,ho))),128))])],2))}},yo={id:"newBooking",class:"modal"},ko={class:"text-end block"},$o={class:"modal-action",style:{"margin-top":"0.5rem"}},wo=["disabled"],_o={__name:"CreateBookingModal",props:{services:Object},emits:["create"],setup(l,{emit:v}){const u=v,o=L({type:null,house:null,extra:null,date:{in:{date:null,time:null},out:{date:null,time:null}},meta:{guests:0,description:null,poslugy:null,source:null}}),p=L([]),s=J(()=>o.value.type&&o.value.house&&o.value.meta.guests>0&&o.value.date.in.time&&o.value.date.in.date&&o.value.date.out.time&&(["lazni","pool"].includes(o.value.type)||o.value.date.out.date)),t=J(()=>s.value);function w(){const{in:b,out:f}=o.value.date;!b.date||o.value.type==="house"&&!f.date||(p.value=se(b.date,f.date||b.date,o.value.type))}function V(){const{type:b,house:f,date:$,meta:d,extra:n}=o.value,_=ae($.in.date,$.in.time,$.out.date,$.out.time,b);let c={g:d.guests,...d.source&&{s:d.source},...d.description&&{d:d.description}};if(["house","lazni"].includes(b)&&p.value.length){const{lazni:y,chan:S}=ie(p.value);c.l={...y&&{l:y},...S&&{c:S}}}u("create",{type:b,house:f,date:_,extra:JSON.stringify(n),meta:c}),B()}function B(){o.value={type:null,house:null,extra:null,date:{in:{date:null,time:null},out:{date:null,time:null}},meta:{guests:0,description:null,poslugy:null,source:null}},p.value=[]}function C(){B(),document.getElementById("newBooking").close()}return(b,f)=>{var $;return a(),r("dialog",yo,[e("form",{class:"modal-box",onSubmit:G(V,["prevent"])},[f[9]||(f[9]=e("h3",{class:"text-lg font-bold mb-4"},"Додати бронювання",-1)),N(ue,{modelValue:o.value.type,"onUpdate:modelValue":f[0]||(f[0]=d=>o.value.type=d)},null,8,["modelValue"]),N(de,{modelValue:o.value.house,"onUpdate:modelValue":f[1]||(f[1]=d=>o.value.house=d),type:o.value.type},null,8,["modelValue","type"]),N(re,{modelValue:o.value.meta.guests,"onUpdate:modelValue":f[2]||(f[2]=d=>o.value.meta.guests=d),disabled:!o.value.type||!o.value.house},null,8,["modelValue","disabled"]),N(ce,{dateIn:o.value.date.in,"onUpdate:dateIn":f[3]||(f[3]=d=>o.value.date.in=d),dateOut:o.value.date.out,"onUpdate:dateOut":f[4]||(f[4]=d=>o.value.date.out=d),type:o.value.type,disabled:o.value.meta.guests===0,onUpdate:w},null,8,["dateIn","dateOut","type","disabled"]),["house","lazni"].includes(o.value.type)&&p.value.length?(a(),H(pe,{key:0,modelValue:p.value,"onUpdate:modelValue":f[5]||(f[5]=d=>p.value=d)},null,8,["modelValue"])):j("",!0),e("div",{class:E(["form-input",{blured:!s.value}])},[f[8]||(f[8]=e("label",null,"Коментар",-1)),I(e("textarea",{"onUpdate:modelValue":f[6]||(f[6]=d=>o.value.meta.description=d),maxlength:"100",rows:"3"},null,512),[[R,o.value.meta.description]]),e("small",ko,h((($=o.value.meta.description)==null?void 0:$.length)||0)+"/100",1)],2),N(me,{modelValue:o.value.meta.source,"onUpdate:modelValue":f[7]||(f[7]=d=>o.value.meta.source=d),disabled:!s.value},null,8,["modelValue","disabled"]),e("div",$o,[e("button",{class:"secondary",type:"button",onClick:C},"Скасувати"),e("button",{type:"submit",disabled:!t.value},"Додати",8,wo)])],32)])}}},Co={id:"editBooking",class:"modal"},xo={class:"text-end block"},Vo={class:"modal-action",style:{"margin-top":"0.5rem"}},So=["disabled"],Bo={__name:"EditBookingModal",props:{services:Object,booking:Object},emits:["update"],setup(l,{expose:v,emit:u}){const o=l,p=u,s=L({type:null,house:null,extra:null,date:{in:{date:null,time:null},out:{date:null,time:null}},meta:{guests:0,description:null,poslugy:null,source:null}}),t=L([]),w=J(()=>s.value.type&&s.value.house&&s.value.meta.guests>0&&s.value.date.in.time&&s.value.date.in.date&&s.value.date.out.time&&(["lazni","pool"].includes(s.value.type)||s.value.date.out.date)),V=J(()=>w.value);K(()=>o.booking,d=>{d&&B(d)},{immediate:!0,deep:!0});function B(d){var _,c,y,S;if(console.log(d),!d)return;const n=zt(d.date,d.type);console.log("-".repeat(20)),console.log(JSON.parse(d.meta)),console.log("-".repeat(20)),s.value={type:d.type,house:d.house,extra:JSON.parse(d.extra),date:n,meta:{guests:((_=JSON.parse(d.meta))==null?void 0:_.g)||0,description:((c=JSON.parse(d.meta))==null?void 0:c.d)||null,source:((y=JSON.parse(d.meta))==null?void 0:y.s)||null}},console.log(d),(S=JSON.parse(d.meta))!=null&&S.l?t.value=Jt(n.in.date,n.out.date||n.in.date,JSON.parse(d.meta).l,d.type):C()}function C(){const{in:d,out:n}=s.value.date;!d.date||s.value.type==="house"&&!n.date||(t.value=se(d.date,n.date||d.date,s.value.type))}function b(){const{type:d,house:n,date:_,meta:c,extra:y}=s.value,S=ae(_.in.date,_.in.time,_.out.date,_.out.time,d);let M={g:c.guests,...c.source&&{s:c.source},...c.description&&{d:c.description}};if(["house","lazni"].includes(d)&&t.value.length){const{lazni:T,chan:F}=ie(t.value);M.l={...T&&{l:T},...F&&{c:F}}}p("update",{id:o.booking.$id,type:d,house:n,date:S,extra:JSON.stringify(y),meta:M}),$()}function f(){s.value={type:null,house:null,extra:null,date:{in:{date:null,time:null},out:{date:null,time:null}},meta:{guests:0,description:null,poslugy:null,source:null}},t.value=[]}function $(){f(),document.getElementById("editBooking").close()}return v({open:()=>{o.booking&&(B(o.booking),document.getElementById("editBooking").showModal())}}),(d,n)=>{var _;return a(),r("dialog",Co,[e("form",{class:"modal-box",onSubmit:G(b,["prevent"])},[n[10]||(n[10]=e("h3",{class:"text-lg font-bold mb-4"},"Редагувати бронювання",-1)),N(ue,{modelValue:s.value.type,"onUpdate:modelValue":n[0]||(n[0]=c=>s.value.type=c)},null,8,["modelValue"]),N(de,{modelValue:s.value.house,"onUpdate:modelValue":n[1]||(n[1]=c=>s.value.house=c),type:s.value.type},null,8,["modelValue","type"]),N(re,{modelValue:s.value.meta.guests,"onUpdate:modelValue":n[2]||(n[2]=c=>s.value.meta.guests=c),disabled:!s.value.type||!s.value.house},null,8,["modelValue","disabled"]),N(ce,{dateIn:s.value.date.in,"onUpdate:dateIn":n[3]||(n[3]=c=>s.value.date.in=c),dateOut:s.value.date.out,"onUpdate:dateOut":n[4]||(n[4]=c=>s.value.date.out=c),type:s.value.type,disabled:s.value.meta.guests===0,onUpdate:C},null,8,["dateIn","dateOut","type","disabled"]),["house","lazni"].includes(s.value.type)&&t.value.length?(a(),H(pe,{key:0,modelValue:t.value,"onUpdate:modelValue":n[5]||(n[5]=c=>t.value=c)},null,8,["modelValue"])):j("",!0),s.value.extra?(a(),H(fo,{key:1,services:s.value.extra,disabled:!w.value,onUpdate:n[6]||(n[6]=c=>s.value.extra=c)},null,8,["services","disabled"])):j("",!0),e("div",{class:E(["form-input",{blured:!w.value}])},[n[9]||(n[9]=e("label",null,"Коментар",-1)),I(e("textarea",{"onUpdate:modelValue":n[7]||(n[7]=c=>s.value.meta.description=c),maxlength:"100",rows:"3"},null,512),[[R,s.value.meta.description]]),e("small",xo,h(((_=s.value.meta.description)==null?void 0:_.length)||0)+"/100",1)],2),N(me,{modelValue:s.value.meta.source,"onUpdate:modelValue":n[8]||(n[8]=c=>s.value.meta.source=c),disabled:!w.value},null,8,["modelValue","disabled"]),e("div",Vo,[e("button",{class:"secondary",type:"button",onClick:$},"Скасувати"),e("button",{type:"submit",disabled:!V.value},"Зберегти",8,So)])],32)])}}},jo={class:"guest-info__item guest-card guest-bookings"},Oo={class:"geust-card__header"},Mo={key:0,onclick:"newBooking.showModal()"},Lo={__name:"GuestBookings",props:{bookings:Object,guest:Object,access:String,name:String},emits:["update:guest"],setup(l,{emit:v}){const u=le(),{user:o}=ne(),p=l,s=v,t=L([]),w=L(null),V=L(null),B=J(()=>{var c;return(c=o.value)!=null&&c.teams?o.value.teams.some(y=>{var S;try{const M=typeof y.prefs=="string"?JSON.parse(y.prefs):y.prefs;return(S=M==null?void 0:M.bookings)==null?void 0:S.includes("create")}catch{return!1}}):!1}),C=J(()=>{var c;return(c=o.value)!=null&&c.teams?o.value.teams.some(y=>{var S;try{const M=typeof y.prefs=="string"?JSON.parse(y.prefs):y.prefs;return(S=M==null?void 0:M.bookings)==null?void 0:S.includes("update")}catch{return!1}}):!1});K(()=>p.bookings,c=>{c&&(t.value=c)},{immediate:!0}),fetch("https://api.laznikyiv.com/v2/services").then(c=>c.json()).then(c=>w.value=c);function b(c){const y={guest:u.params.id,type:c.type,house:c.type==="pool"?"family":c.house,date:c.date,extra:c.extra?c.extra:null,meta:JSON.stringify(c.meta)};Q.bookings.create(y).then(S=>{t.value.push(S.booking),document.getElementById("newBooking").close()})}function f(c){const y={guest:u.params.id,type:c.type,house:c.type==="pool"?"family":c.house,date:c.date,meta:JSON.stringify(c.meta)};Q.bookings.update(V.value.$id,y).then(S=>{const M=t.value.findIndex(T=>T.$id===c.$id);M>-1&&(t.value[M]=S),X.success("Бронювання оновлено"),n()}).catch(S=>{console.error("Update error:",S),X.error("Помилка оновлення")})}const $=L(null);function d(c){V.value=JSON.parse(JSON.stringify(c)),console.log(V.value),fe(()=>{var y;(y=$.value)!=null&&y.showModal?$.value.showModal():document.getElementById("editBooking").showModal()})}function n(){var c;V.value=null,(c=$.value)!=null&&c.close&&$.value.close()}function _(c){s("update:guest",c)}return(c,y)=>(a(),r("div",jo,[e("div",Oo,[y[0]||(y[0]=e("h3",null,"Бронювання",-1)),t.value.length>0&&B.value?(a(),r("button",Mo," + ")):j("",!0)]),t.value.length<1?(a(),H(wt,{key:0,canAddBookings:B.value},null,8,["canAddBookings"])):(a(),H(Dt,{key:1,bookings:t.value,guest:l.guest,canUpdateBookings:C.value,onEdit:d,"onUpdate:guest":_},null,8,["bookings","guest","canUpdateBookings"])),N(_o,{services:w.value,onCreate:b},null,8,["services"]),V.value?(a(),H(Bo,{key:2,ref_key:"editBookingModal",ref:$,booking:V.value,services:w.value,onUpdate:f,onClose:n},null,8,["booking","services"])):j("",!0)]))}},Do={class:"guest-info"},Uo={__name:"GuestView",setup(l){const v=L(null),u=L(null),o=L([]),p=le();be(async()=>{Q.guests.get(p.params.id).then(t=>{u.value=t.guest,o.value=t.bookings}).catch(t=>{sessionStorage.setItem("guest-error","get-error"),he.push("/guests/")})});function s(t){console.log("GuestView.vue [update]",t),u.value=t}return(t,w)=>(a(),H(ve,null,{default:ye(()=>{var V;return[e("div",Do,[N(it,{guest:u.value,auth:v.value,onUpdate:w[0]||(w[0]=B=>u.value=B)},null,8,["guest","auth"]),N(yt,{guest:u.value,auth:v.value},null,8,["guest","auth"]),N(Lo,{bookings:o.value,guest:u.value,access:v.value,name:(V=u.value)==null?void 0:V.alias,"onUpdate:guest":s},null,8,["bookings","guest","access","name"])])]}),_:1}))}},Po=te(Uo,[["__scopeId","data-v-186ac846"]]);export{Po as default};
